"use strict";var kite={browser:{}},nbe={browser:{icon:{}},dynamic:{},css:{},site:{},lib:{},doc:{},state:{},inputs:{},notify:{},format:{},location:{},events:{},triggers:{},ops:{},editor:{},paste:{},title:{},publish:{}};(function(){typeof console=="undefined"&&(console={}),typeof console.log=="undefined"&&(console.log=function(){})})(),typeof document!="undefined"&&!("classList"in document.createElement("a"))&&function(a){var b,c,d,e,f,g,h,i,j,k,l,m;b="classList",c="prototype",d=(a.HTMLElement||a.Element)[c],e=Object,f=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[c].indexOf||function(a){var b,c;c=this.length;for(b=0;b<c;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){this.name=a,this.code=DOMException[a],this.message=b},i=function(a,b){if(b==="")throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(a,b)},j=function(a){var b,c,d,e;b=f.call(a.className),c=b?b.split(/\s+/):[],e=c.length;for(d=0;d<e;d++)this.push(c[d]);this._updateClassName=function(){a.className=this.toString()}},k=j[c]=[],l=function(){return new j(this)},h[c]=Error[c],k.item=function(a){return this[a]||null},k.contains=function(a){return a+="",i(this,a)!==-1},k.add=function(a){a+="",i(this,a)===-1&&(this.push(a),this._updateClassName())},k.remove=function(a){var b;a+="",b=i(this,a),b!==-1&&(this.splice(b,1),this._updateClassName())},k.toggle=function(a){a+="",i(this,a)===-1?this.add(a):this.remove(a)},k.toString=function(){return this.join(" ")};if(e.defineProperty){m={get:l,enumerable:!0,configurable:!0};try{e.defineProperty(d,b,m)}catch(n){n.number===-2146823252&&(m.enumerable=!1,e.defineProperty(d,b,m))}}else e[c].__defineGetter__&&d.__defineGetter__(b,l)}(window.self);if(window.Element&&!window.addEventListener){var attach,remove;attach=function(a,b,c){this.attachEvent("on"+a,function(){var a;a=window.event,a.target=a.srcElement,b(a)})},remove=function(a,b,c){this.detachEvent("on"+a,b)},window.Element.prototype.addEventListener=attach,window.Element.prototype.removeEventListener=remove,Window.prototype.addEventListener=attach,Window.prototype.removeEventListener=remove,document.addEventListener=attach,document.removeEventListener=remove}Object.keys||(Object.keys=function(){var a,b,c,d;return a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length,function(e){var f,g,h;if(typeof e!="object"&&typeof e!="function"||e===null)throw new TypeError("Object.keys called on non-object");f=[];for(g in e)a.call(e,g)&&f.push(g);if(b)for(h=0;h<d;h++)a.call(e,c[h])&&f.push(c[h]);return f}}()),Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e,f,g,h,i;if(this===null)throw new TypeError(" this is null or not defined");f={},g=f.length>0;if({}.toString.call(a)!=="[object Function]")throw new TypeError(a+" is not a function");b&&(c=b),d=new Array(g),e=0;while(e<g)e in f&&(h=f[e],i=a.call(c,h,e,f),d[e]=i),e++;return d}),Date.now=Date.now||function(){return+(new Date)},Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b,c,d,e;if(this===null)throw new TypeError;b={},c=b.length>0;if(c===0)return-1;d=0,arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:d!==0&&d!==Infinity&&d!==-Infinity&&(d=(d>0||-1)*Math.floor(Math.abs(d))));if(d>=c)return-1;e=d>=0?d:Math.max(c-Math.abs(d),0);for(;e<c;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";var b,c,d,e,f,g;if(this===null)throw new TypeError;b={},c=b.length>0;if(typeof a!="function")throw new TypeError;d=[],e=arguments[1];for(f=0;f<c;f++)f in b&&(g=b[f],a.call(e,g,f,b)&&d.push(g));return d}),Array.prototype.forEach||(Array.prototype.forEach=function(b,c){var d,e,f,g,h;if(this===null)throw new TypeError("this is null or not defined");f={},g=f.length>0;if({}.toString.call(b)!=="[object Function]")throw new TypeError(b+" is not a function");c&&(d=c),e=0;while(e<g)Object.prototype.hasOwnProperty.call(f,e)&&(h=f[e],b.call(d,h,e,f)),e++}),nbe.site.panel=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;c=nbe.state.formats.default_values,d="off:on",e=!1,f={},g=kite.browser.dom.eac("div",a,"wu-format-panel"),h=function(){e?(g.className="wu-format-panel",i.textContent="More"):(g.className="wu-format-panel open",i.textContent="Less"),e=!e},i=kite.browser.dom.eac("button",a,"wu-toggle circle_button"),i.textContent="More",i.addEventListener("click",h,!1),g.addEventListener("click",function(a){(a.target.classList.contains("wu-icon")||a.target.parentNode.classList.contains("drop_down_menu")||a.target.parentNode.parentNode.classList.contains("drop_down_menu"))&&h()},!1),j=kite.browser.dom.ea("div",g),f.heading=nbe.inputs.heading(b.trigger,"Heading",{none:"No heading (-)",heading1:'<span class="line heading1">Heading 1 (H1)</span>',heading2:'<span class="line heading2">Heading 2 (H2)</span>',heading3:'<span class="line heading3">Heading 3 (H3)</span>',heading4:'<span class="line heading4">Heading 4 (H4)</span>',heading5:'<span class="line heading5">Heading 5 (H5)</span>',heading6:'<span class="line heading6">Heading 6 (H6)</span>'},{none:"-",heading1:"H1",heading2:"H2",heading3:"H3",heading4:"H4",heading5:"H5",heading6:"H6"},j,c.heading),k={},nbe.state.formats.font_family.forEach(function(a){var b;b=a[0].toUpperCase()+a.slice(1),k[a]='<span style="font-family : '+b+';">'+b+"</span>"}),f.font_family=nbe.inputs.font_family(b.trigger,"Font",k,j,c.font_family),f.font_size=nbe.inputs.font_size(b.trigger,"Font size",{"10px":"10","11px":"11","12px":"12","13px":"13","14px":"14","16px":"16","18px":"18","20px":"20","22px":"22","24px":"24","28px":"28","32px":"32","36px":"36","48px":"48","72px":"72"},j,c.font_size),l=kite.browser.dom.ea("div",g),f.bold=nbe.inputs.bold(b.trigger,"Bold",l,c.bold),f.italic=nbe.inputs.italic(b.trigger,"Italic",l,c.italic),f.underline=nbe.inputs.underline(b.trigger,"Underline",l,c.underline),f.strikethrough=nbe.inputs.strikethrough(b.trigger,"Strikethrough",l,c.strikethrough),m=kite.browser.dom.ea("div",g),f.color=nbe.inputs.color(b.trigger,"Text color",m,c.color),f.background_color=nbe.inputs.background_color(b.trigger,"Line color",m,c.background_color),f.vertical_align=nbe.inputs.vertical_align(b.trigger,kite.browser.dom.ea("div",g),c.vertical_align),f.left_margin=nbe.inputs.left_margin(b.trigger,kite.browser.dom.ea("div",g),d),n=kite.browser.dom.ea("div",g),f.text_align=nbe.inputs.text_align(b.trigger,"Text align",{left:"Left",center:"Center",right:"Right",justify:"Justify"},n,c.text_align),f.line_spacing=nbe.inputs.line_spacing(b.trigger,"Line spacing",{line_spacing_05:"0.5",line_spacing_06:"0.6",line_spacing_07:"0.7",line_spacing_08:"0.8",line_spacing_09:"0.9",line_spacing_10:"1",line_spacing_11:"1.1",line_spacing_12:"1.2",line_spacing_13:"1.3",line_spacing_14:"1.4",line_spacing_15:"1.5",line_spacing_16:"1.6 (default)",line_spacing_17:"1.7",line_spacing_18:"1.8",line_spacing_19:"1.9",line_spacing_20:"2"},n,c.line_spacing),f.list=nbe.inputs.list(b.trigger,"List",{none:"none",disc:"•",square:"▀",ordered:"1. 2. 3.","lower-alpha":"a. b. c.","upper-alpha":"A. B. C.","lower-roman":"i. ii. iii.","upper-roman":"I. II. III."},kite.browser.dom.ea("div",g),c.list),o=kite.browser.dom.ea("div",g),f.special_characters=nbe.inputs.special_characters(b.trigger,"Special characters",o,null),f.insert_link=nbe.inputs.insert_link(b.trigger,"Insert link",o),f.edit_link=nbe.inputs.edit_link(b.trigger,"Edit link",o,null),f.insert_img=nbe.inputs.insert_image(b.trigger,"Insert image",o),f.edit_img=nbe.inputs.edit_image(b.trigger,"Edit image",o,null);for(p in f)f.hasOwnProperty(p)&&b.inputs.add(p,f[p]);q=nbe.inputs.undo(b.trigger,kite.browser.dom.ea("div",g)),b.undo.add_button(q),r=kite.browser.dom.eac("button",g,"hide circle_button"),r.textContent="Close",r.addEventListener("click",h,!1)},nbe.site.status_panel=function(a){var b,c,d,e,f,g,h,i,j;return b=kite.browser.dom.ec("div","status_panel"),c=nbe.site.display_share(a),d=kite.browser.dom.eac("button",b,"circle_button"),d.textContent="Share",d.addEventListener("click",function(b){c.display(a)},!1),e=nbe.site.display_export(a),f=nbe.browser.icon.exporticon(b),f.addEventListener("click",function(a){e.display()},!1),g=nbe.browser.icon.network(b),h=nbe.browser.icon.saved(b),i=function(a,b){a==="network"?b==="connected"?g.on():g.off():a==="nunsaved"&&(b>0?h.off():h.on())},j=function(a){a.appendChild(b)},{set_status:i,display:j}},nbe.site.display_demo=function(){var a,b,c,d;a=nbe.doc.create({id:"demo",read:null,write:null,new_doc:!0},!1,null,function(a,b){}),b=[{domop:"append",id:"line2",parent:"root",type:"line",val:{}},{domop:"append",id:"line3",parent:"root",type:"line",val:{}},{domop:"append",id:"line4",parent:"root",type:"line",val:{}},{domop:"append",id:"line5",parent:"root",type:"line",val:{heading:"heading4"}},{domop:"append",id:"line6",parent:"root",type:"line",val:{}},{domop:"append",id:"line7",parent:"root",type:"line",val:{}},{domop:"append",id:"line8",parent:"root",type:"line",val:{}},{domop:"append",id:"line9",parent:"root",type:"line",val:{list:"ordered"}},{domop:"append",id:"line10",parent:"root",type:"line",val:{list:"ordered"}},{domop:"append",id:"line11",parent:"root",type:"line",val:{list:"ordered"}},{domop:"append",id:"line12",parent:"root",type:"line",val:{list:"ordered"}},{domop:"append",id:"line13",parent:"root",type:"line",val:{list:"ordered"}},{domop:"append",id:"line14",parent:"root",type:"line",val:{list:"ordered"}},{domop:"append",id:"line15",parent:"root",type:"line",val:{list:"ordered"}},{domop:"append",id:"line16",parent:"root",type:"line",val:{}},{domop:"append",id:"line17",parent:"root",type:"line",val:{text_align:"center"}},{domop:"append",id:"line18",parent:"root",type:"line",val:{text_align:"center"}},{domop:"append",id:"line19",parent:"root",type:"line",val:{text_align:"center"}},{domop:"append",id:"line20",parent:"root",type:"line",val:{}},{domop:"append",id:"line21",parent:"root",type:"line",val:{}},{domop:"append",id:"line22",parent:"root",type:"line",val:{left_margin:20}},{domop:"append",id:"line23",parent:"root",type:"line",val:{left_margin:40}},{domop:"append",id:"line24",parent:"root",type:"line",val:{}},{domop:"append",id:"line25",parent:"root",type:"line",val:{}},{domop:"append",id:"line26",parent:"root",type:"line",val:{}},{domop:"append",id:"line27",parent:"root",type:"line",val:{}},{domop:"append",id:"line28",parent:"root",type:"line",val:{}},{domop:"append",id:"text1.2",parent:"line",type:"text",val:{text:"Write in the left windows and see changes in the right window"}},{domop:"append",id:"text3.1",parent:"line3",type:"text",val:{text:"You can insert "}},{domop:"append",id:"link3.2",parent:"line3",type:"link",val:{href:"www.writeurl.com"}},{domop:"append",id:"text3.3",parent:"link3.2",type:"text",val:{text:"links"}},{domop:"append",id:"text3.4",parent:"line3",type:"text",val:{text:", images "}},{domop:"append",id:"img3.5",parent:"line3",type:"img",val:{src:"/img/nyckelpiga.jpg",height:"50"}},{domop:"append",id:"text3.6",parent:"line3",type:"text",val:{text:" and special characters : αβγ"}},{domop:"append",id:"text5.1",parent:"line5",type:"text",val:{text:"Lines can have headers"}},{domop:"append",id:"text7.1",parent:"line7",type:"text",val:{text:"There are lists and formatted text"}},{domop:"append",id:"text9.1",parent:"line9",type:"text",val:{text:"bold",bold:"on"}},{domop:"append",id:"text10.1",parent:"line10",type:"text",val:{text:"italic",italic:"on"}},{domop:"append",id:"text11.1",parent:"line11",type:"text",val:{text:"underline",underline:"on"}},{domop:"append",id:"text12.1",parent:"line12",type:"text",val:{text:"strikethrough",strikethrough:"on"}},{domop:"append",id:"text13.1",parent:"line13",type:"text",val:{text:"color",color:"rgb(255,0,0)"}},{domop:"append",id:"text14.1",parent:"line14",type:"text",val:{text:"line color",background_color:"rgb(255,255,0)"}},{domop:"append",id:"text15.1",parent:"line15",type:"text",val:{text:"superscript",vertical_align:"super"}},{domop:"append",id:"text15.2",parent:"line15",type:"text",val:{text:" and "}},{domop:"append",id:"text15.3",parent:"line15",type:"text",val:{text:"subscript",vertical_align:"sub"}},{domop:"append",id:"text17.1",parent:"line17",type:"text",val:{text:"Text alignments can be left,"}},{domop:"append",id:"text18.1",parent:"line18",type:"text",val:{text:"center (as here),"}},{domop:"append",id:"text19.1",parent:"line19",type:"text",val:{text:"right and justify."}},{domop:"append",id:"text21.1",parent:"line21",type:"text",val:{text:"Text can"}},{domop:"append",id:"text22.1",parent:"line22",type:"text",val:{text:"also have"}},{domop:"append",id:"text23.1",parent:"line23",type:"text",val:{text:"indentation levels"}},{domop:"append",id:"text25.1",parent:"line25",type:"text",val:{text:"Undo ( button or ctrl-z), redo (button or ctrl-shift-z)"}},{domop:"append",id:"text26.1",parent:"line26",type:"text",val:{text:"Copy (ctrl-c), cut (ctrl-x), paste (ctrl-v)"}},{domop:"append",id:"text28.1",parent:"line28",type:"text",val:{text:"spell check, fonts, line spacing."}}],a.add_ops(null,b),c=a.editors.add("editor_write","text",{editable:!0}),document.getElementById("editor_write").appendChild(c.el_editor),d=a.editors.add("editor_read","text",{editable:!1}),document.getElementById("editor_read").appendChild(d.el_editor),nbe.site.panel(document.getElementById("demo_panel"),c)},nbe.site.display_editor=function(a){var b,c,d,e;b=a.ids.write!==null,document.getElementById("frontpage").style.display="none",b?document.body.className="editor":(document.getElementById("home").style.display="none",document.getElementById("feedback").style.display="none",document.getElementById("faq").style.display="none",document.body.className="read_editor"),c=a.editors.add("editor","text",{editable:b}),d=kite.browser.dom.eac("div",document.body,"editor_container"),b&&nbe.site.panel(document.getElementById("panel"),c),e=a.editors.add("title_editor","title",{editable:b,html_title:!0}),b&&kite.browser.dom.eac("div",d,"wu-title-container").appendChild(e.el_editor),nbe.dynamic.get_title=e.get_value,nbe.dynamic.publish=a.editors.add("publish_editor","publish",{}),d.appendChild(c.el_editor),a.ids.prefix==="scroller"&&a.ids.write===null&&nbe.site.scroller(c)},nbe.site.display_share=function(a){var b,c,d,e,f,g,h;return b=new kite.browser.ui.Window,b.set_title("Share"),c=kite.browser.dom.ec("div","nbe_window share"),kite.browser.dom.ea("img",c).src="/img/fork.svg",kite.browser.dom.ea("h1",c).textContent="Share",kite.browser.dom.ea("p",c).textContent="Share the write URL with collaborators or share the read or publish URLs with readers.",d=function(a,b,d){var e,f,g;return e=kite.browser.dom.ea("div",c),f=kite.browser.dom.ea("h2",e),f.textContent=a,kite.browser.dom.ea("span",f).textContent=b,g=kite.browser.dom.ea("a",e),g.textContent=d,g.href=d,g.target="_blank",{element:e,url:g}},d("Write URL","(Collaborators can edit the document with this URL)",nbe.config.urls(a).write),d("Read URL","(Readers can view the document and see changes as you type)",nbe.config.urls(a).read),e=d("Publish URL","(Readers can view the published version of this document)",nbe.config.urls(a).publish),function(){var a;a=kite.browser.dom.ea("button",e.element),a.textContent="Publish",f=kite.browser.dom.ea("span",e.element),a.addEventListener("click",function(a){nbe.dynamic.publish.publish(function(a){a==="published"?(f.textContent="The document is published!",f.className="message_success",e.url.className="visible"):a==="not published"?(f.textContent="Error, please try again.",f.className="message_failure"):(f.textContent="Network error.",f.className="message_failure")})},!1)}(),function(){var b,d,e,f,g,i,j,k,l,m;b=kite.browser.dom.ea("div",c),d="publish",e=function(a){g.className="",i.className="",j.className="",a.target===g?(d="write",g.className="active"):a.target===i?(d="read",i.className="active"):a.target===j&&(d="publish",j.className="active")},f=kite.browser.dom.eac("div",b,"share_email"),kite.browser.dom.ea("h2",f).textContent="Share via e-mail",kite.browser.dom.ea("div",f).textContent="Select URL to share:",g=kite.browser.dom.ea("button",f),g.textContent="Write",g.addEventListener("click",e),i=kite.browser.dom.ea("button",f),i.textContent="Read",i.addEventListener("click",e),j=kite.browser.dom.ea("button",f),j.textContent="Publish",j.addEventListener("click",e),j.className="active",kite.browser.dom.ea("div",f).textContent="E-mail address(es):",k=kite.browser.dom.ea("textarea",f),k.setAttribute("autocapitalize","none"),kite.browser.dom.ea("div",f).textContent="Message (optional):",l=kite.browser.dom.ea("textarea",f),m=kite.browser.dom.eac("button",f,"send"),m.textContent="Send",m.addEventListener("click",function(b){var c,e;e=nbe.lib.share_emails(k.value),e.invalid.length===0&&e.valid.length!==0?(c={type:"share",emails:e.valid,message:l.value,access:d,url:nbe.config.urls(a)[d],title:nbe.dynamic.get_title()},nbe.lib.xhr("POST",nbe.config.share_url,{},JSON.stringify(c),0,function(a){k.value="",h.textContent="The invitation has been sent.",h.className="message_success"},function(){},function(){h.textContent="Internet connection error, please try again.",h.className="message_failure"})):(e.invalid.length!==0?h.textContent="These email addresses are invalid. Please correct them.\n\n"+e.invalid.join("\n"):h.textContent="Please specify the email address(es).",h.className="message_failure")},!1),h=kite.browser.dom.ea("span",f)}(),g=kite.browser.dom.ea("button",c),g.textContent="Close",g.addEventListener("click",function(a){b.close()},!1),b.set_content(c),{display:function(){h.textContent="",f.textContent="",e.element.appendChild(nbe.dynamic.publish.msg),nbe.dynamic.publish.get_time()===null?e.url.className="hidden":e.url.className="visible",b.open()}}},nbe.site.display_feedback=function(){var a,b,c,d,e,f,g,h,i,j;b=new kite.browser.ui.Window,b.set_title("Feedback"),a=document.getElementById("feedback"),a.addEventListener("click",function(a){b.open()},!1),c=kite.browser.dom.ec("div","nbe_window feedback"),kite.browser.dom.ea("div",c).innerHTML="!",kite.browser.dom.ea("h1",c).innerHTML="Feedback",kite.browser.dom.ea("p",c).innerHTML="Your opinion is very valuable to us, please let us know what you think.",kite.browser.dom.ea("h3",c).innerHTML="Name",d=kite.browser.dom.ea("input",c),d.type="text",kite.browser.dom.ea("h3",c).innerHTML="E-mail",e=kite.browser.dom.input("email",null,null,null,null,null,c),e.setAttribute("autocapitalize","none"),kite.browser.dom.ea("h3",c).innerHTML="Message",f=kite.browser.dom.ea("textarea",c),g=kite.browser.dom.ea("footer",c),h=kite.browser.dom.ea("button",g),h.innerHTML="Send",h.addEventListener("click",function(a){if(f.value)if(!e.value||e.value&&nbe.lib.valid_email(e.value)){var b={type:"feedback",name:d.value,mail:e.value,message:f.value};nbe.lib.xhr("POST",nbe.config.feedback_url,{},JSON.stringify(b),0,function(a){d.value="",e.value="",f.value="",i.innerHTML="Email sent.",i.className="message_success",setTimeout(function(){kite.browser.animation.Fade_out(i,{duration:4e3})},2e3)},function(){},function(){i.innerHTML="Server error, please try again.",i.className="message_failure",setTimeout(function(){kite.browser.animation.Fade_out(i,{duration:4e3})},2e3)})}else i.innerHTML="The email address is incorrect.",i.className="message_failure",setTimeout(function(){kite.browser.animation.Fade_out(i,{duration:4e3})},2e3);else i.innerHTML="Please write a message.",i.className="message_failure",setTimeout(function(){kite.browser.animation.Fade_out(i,{duration:4e3})},2e3)},!1),i=kite.browser.dom.ea("div",g),j=kite.browser.dom.ea("button",g),j.innerHTML="Close",j.addEventListener("click",function(a){b.close()},!1),b.set_content(c)},nbe.site.display_export=function(){var a,b,c,d,e,f;return a=new kite.browser.ui.Window,a.set_title("Export"),b=kite.browser.dom.ec("div","nbe_window share"),kite.browser.dom.ea("img",b).src="/img/export.svg",kite.browser.dom.ea("h1",b).textContent="Export",kite.browser.dom.ea("p",b).textContent="Please select format by clicking one of the buttons and the file will be downloaded to your device.",c=kite.browser.dom.ea("div",b),kite.browser.dom.ea("p",c).textContent="Please note that export currently only works in Google Chrome.",d=kite.browser.dom.ea("button",c),d.textContent="Word",d.addEventListener("click",function(a){nbe.lib.save_as(new Blob([nbe.doc.html(nbe.dynamic.doc)],{type:"application/vnd.ms-word"}),nbe.dynamic.get_title()+".doc")},!1),e=kite.browser.dom.ea("button",c),e.textContent="HTML",e.addEventListener("click",function(a){nbe.lib.save_as(new Blob([nbe.doc.html(nbe.dynamic.doc)],{type:"text/html"}),nbe.dynamic.get_title()+".html")},!1),kite.browser.dom.ea("p",b),f=kite.browser.dom.ea("button",b),f.textContent="Close",f.addEventListener("click",function(b){a.close()},!1),a.set_content(b),{display:function(){a.open()}}},nbe.site.doc_noexist=function(a){var b;b=kite.browser.dom.eac("div",document.body,"full_screen_message"),kite.browser.dom.ea("div",b).textContent="The document is not known to the server."},nbe.site.wrong_password=function(){var a;a=kite.browser.dom.eac("div",document.body,"full_screen_message"),kite.browser.dom.ea("div",a).textContent="It seems like you're not using a proper URL for this document, please check your link."},nbe.site.loading=function(){var a,b,c,d;return a=document.createElement("div"),a.className="full_screen_message",kite.browser.dom.ea("div",a).textContent="We are trying to connect to the server.",b="init",c=function(){setTimeout(function(){b==="init"&&(b="on",document.body.appendChild(a))},200)},d=function(){b==="on"&&document.body.removeChild(a),b="off"},{on:c,off:d}},nbe.site.supported_doc=function(){var a=kite.browser.dom.eac("div",document.body,"full_screen_message");kite.browser.dom.ea("div",a).innerHTML="Your browser is not supported."},nbe.site.supported_front=function(a){var b;b=document.getElementById("new_doc"),a?b.addEventListener("click",function(a){window.open(nbe.config.new_url(),"_blank")},!1):(b.innerHTML="Your browser is not supported.",b.className="unsupported")},nbe.site.scroller=function(a){var b,c;b=a.el_editor,c=b.parentNode.classList.contains("editor_container")?b.parentNode:b,setInterval(function(){c.scrollTop=c.scrollHeight},200)},nbe.site.embed=function(a,b,c,d,e,f,g,h,i){var j,k,l,m;j=d.write!==null&&d.write!=="",k=function(a){return typeof a=="string"?document.getElementById(a):a},l=function(d,e){var f,g;i(d,e),d==="doc"&&e==="exist"&&(m.comm.notify(),f=m.editors.add("editor","text",{editable:j}),a&&k(a).appendChild(f.el_editor),b&&(g=m.editors.add("title_editor","title",{editable:j,html_title:h}),k(b).appendChild(g.el_editor)),c&&nbe.site.panel(k(c),f))},d.new_doc=e,m=nbe.doc.create(d,g,f,l),m.server_status!=="unknown"&&l("doc","exist")},nbe.site.embed_read=function(a,b){var c,d,e;a=typeof a=="string"?document.getElementById(a):a,c="ws://www.writeurl.com:8043",b.write=null,d=document.createElement("div"),a.appendChild(d),e=document.createElement("div"),a.appendChild(e),nbe.site.embed(e,d,null,b,!1,c,!0,!1,function(){})},nbe.site.embed_write=function(a,b){var c,d,e,f;a=typeof a=="string"?document.getElementById(a):a,c="ws://www.writeurl.com:8043",d=document.createElement("div"),a.appendChild(d),e=document.createElement("div"),a.appendChild(e),f=document.createElement("div"),a.appendChild(f),console.log(b),nbe.site.embed(f,e,d,b,!1,c,!0,!1,function(){})},nbe.site.embed_new=function(a){var b,c,d,e,f;return a=typeof a=="string"?document.getElementById(a):a,b="ws://www.writeurl.com:8043",c=document.createElement("div"),a.appendChild(c),d=document.createElement("div"),a.appendChild(d),e=document.createElement("div"),a.appendChild(e),f={id:nbe.lib.rnd_string(20),read:nbe.lib.rnd_string(20),write:nbe.lib.rnd_string(20)},nbe.site.embed(e,d,c,f,!0,b,!0,!1,function(){}),f},nbe.config=function(){var a,b,c,d,e,f,g,h,i;return a=window.location.host,b="/",c=function(a){var b;return b=/^[a-z0-9]{3,}$/,b.test(a)},d=function(a){var b,d;return b=a.split("/"),d={prefix:b.length>1?b[1]:null,id:b.length>2&&c(b[2])?b[2]:null,read:b.length>3&&c(b[3])?b[3]:null,write:b.length>4&&c(b[4])?b[4]:null,new_doc:b.length>5&&b[5]==="new"},d},e=function(a){return"/publish/"+a.id},f=function(a){return"/text/"+a.id+"/"+a.read},g=function(a){return f(a)+"/"+a.write},h=function(b){var c;return c="http://"+a,{publish:c+e(b),read:c+f(b),write:c+g(b)}},i=function(){var a;return a={id:nbe.lib.rnd_string(20),read:nbe.lib.rnd_string(20),write:nbe.lib.rnd_string(20)},h(a).write+"/new"},{title:"My Title",home_pathname:b,write_pathname:g,urls:h,new_url:i,parse_pathname:d,local_storage:!0,ws_url:"ws://"+a+":8043",share_url:"http://"+a+":8050",feedback_url:"http://"+a+":8050",publish_url:"http://"+a+":8050",file_upload_url:"http://"+a+":8051"}}(),nbe.lib.clone=function(a){return JSON.parse(JSON.stringify(a))},nbe.lib.xhr=function(a,b,c,d,e,f,g,h){var i,j;i=new XMLHttpRequest,i.onreadystatechange=function(){i.readyState===4&&(i.status===200?f(i.responseText):g())},i.onerror=function(){h()},i.ontimeout=function(){h()},i.open(a,b,!0),i.timeout=e;for(j in c)c.hasOwnProperty(j)&&i.setRequestHeader(j,c[j]);i.send(d)},nbe.lib.rnd_random_org=function(){var a,b,c,d,e;return a=!1,a=!0,b=40,c="",d=function(){var b;a||(a=!0,b="http://www.random.org/strings/?num=3&len=20&digits=on&upperalpha=off&loweralpha=on&unique=off&format=plain&rnd=new",nbe.lib.xhr("GET",b,{},"",0,function(b){a=!1;try{c+=b.split("\n").join("")}catch(d){}},function(){a=!1},function(){a=!1}))},d(),e=function(a){var e;return e="",c.length>=a&&(e=c.slice(0,a),c=c.slice(a)),c.length<b&&d(),e},e}(),nbe.lib.rnd_crypto=function(a){var b,c,d;b=[];if("crypto"in window&&"getRandomValues"in window.crypto){c=new Uint8Array(a),window.crypto.getRandomValues(c);for(d=0;d<a;d++)b[d]=c[d].toString(36).slice(-1)}return b.join("")},nbe.lib.rnd_math_random=function(a){var b,c;b=[];for(c=0;c<a;c++)b[c]=Math.floor(36*Math.random()).toString(36);return b.join("")},nbe.lib.rnd_string=function(a){var b;return b=nbe.lib.rnd_random_org(a),b.length!==a&&(b=nbe.lib.rnd_crypto(a)),b.length!==a&&(b=nbe.lib.rnd_math_random(a)),b},nbe.lib.partial_copy=function(a,b,c){var d,e;for(d=0;d<c.length;d++)e=c[d],e in a&&(b[e]=a[e]);return b},nbe.lib.get_attributes=function(a,b){var c,d,e;c={},d=function(b){var d;d=a.getAttribute("data-"+b),d&&(c[b]=d)};for(e=0;e<b.length;e++)d(b[e]);return c},nbe.lib.set_attributes=function(a,b,c){var d,e;d=function(b){b in c?a.setAttribute("data-"+b,c[b]):a.removeAttribute("data-"+b)};for(e=0;e<b.length;e++)d(b[e]);return a},nbe.lib.new_id=function(){var a,b;return a=nbe.lib.rnd_string(12),b=0,function(){var c;return c=a+b,b++,c}},nbe.lib.valid_email=function(a){var b;return b=/^[\-a-z0-9~!$%\^&*_=+}{\'?]+(\.[\-a-z0-9~!$%\^&*_=+}{\'?]+)*@([a-z0-9_][\-a-z0-9_]*(\.[\-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,typeof a=="string"&&b.test(a)},nbe.lib.share_emails=function(a){var b,c,d;return b=a.split(/[ ,\n]/).filter(function(a){return a!==""}),c=[],d=[],b.forEach(function(a){nbe.lib.valid_email(a)?c.push(a):d.push(a)}),{valid:c,invalid:d}},nbe.lib.file_upload=function(a,b){var c,d,e;c=function(a){var b;return b=a.name.match(/\.([a-zA-Z]+)/),d=b?b[1]:null,d},d=c(a),d===null?b(null):(e=new FileReader,e.onload=function(a){nbe.lib.xhr("POST",nbe.config.file_upload_url,{"X-File-Ending":d},e.result,0,function(a){b(JSON.parse(a))},function(){b(null)},function(){b(null)})},e.readAsArrayBuffer(a))},nbe.lib.save_as=function(a){"use strict";var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=a.URL||a.webkitURL||a,e=b.createElementNS("http://www.w3.org/1999/xhtml","a"),f="download"in e,g=function(c){var d=b.createEvent("MouseEvents");return d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},h=a.webkitRequestFileSystem,i=a.requestFileSystem||h||a.mozRequestFileSystem,j=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},k="application/octet-stream",l=0,m=[],n=function(){var a,b;a=m.length;while(a)a-=1,b=m[a],typeof b=="string"?d.revokeObjectURL(b):b.remove();m.length=0},o=function(a,b,c){b=[].concat(b);var d,e;d=b.length;while(d){d-=1,e=a["on"+b[d]];if(typeof e=="function")try{e.call(a,c||a)}catch(f){j(f)}}},p=function(b,d){var j=this,n=b.type,p=!1,q,r,s=function(){var a=c().createObjectURL(b);return m.push(a),a},t=function(){o(j,"writestart progress write writeend".split(" "))},u=function(){if(p||!q)q=s(b);r.location.href=q,j.readyState=j.DONE,t()},v=function(a){return function(){if(j.readyState!==j.DONE)return a.apply(this,arguments)}},w={create:!0,exclusive:!1},x;j.readyState=j.INIT,d||(d="download");if(f){q=s(b),e.href=q,e.download=d;if(g(e)){j.readyState=j.DONE,t();return}}a.chrome&&n&&n!==k&&(x=b.slice||b.webkitSlice,b=x.call(b,0,b.size,k),p=!0),h&&d!=="download"&&(d+=".download"),n===k||h?r=a:r=a.open();if(!i){u();return}l+=b.size,i(a.TEMPORARY,l,v(function(a){a.root.getDirectory("saved",w,v(function(a){var c=function(){a.getFile(d,w,v(function(a){a.createWriter(v(function(c){c.onwriteend=function(b){r.location.href=a.toURL(),m.push(a),j.readyState=j.DONE,o(j,"writeend",b)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&u()},"writestart progress write abort".split(" ").forEach(function(a){c["on"+a]=j["on"+a]}),c.write(b),j.abort=function(){c.abort(),j.readyState=j.DONE},j.readyState=j.WRITING}),u)}),u)};a.getFile(d,{create:!1},v(function(a){a.remove(),c()}),v(function(a){a.code===a.NOT_FOUND_ERR?c():u()}))}),u)}),u)},q=p.prototype,r=function(a,b){return new p(a,b)};return q.abort=function(){var a=this;a.readyState=a.DONE,o(a,"abort")},q.readyState=q.INIT=0,q.WRITING=1,q.DONE=2,q.error=q.onwritestart=q.onprogress=q.onwrite=q.onabort=q.onerror=q.onwriteend=null,a.addEventListener("unload",n,!1),r}(window.self),nbe.doc.create=function(a,b,c,d){var e;return e={},e.ids=a,e.server_status="unknown",e.state=nbe.doc.state_init(),e.n_operations_server=0,e.operations_local=[],e.local_storage=nbe.doc.local_storage(e,b),e.local_storage.read(),e.server_status==="unknown"&&a.new_doc&&(e.server_status="new",e.local_storage.write()),delete a.new_doc,e.editors=nbe.doc.editors(e),e.new_id=nbe.lib.new_id(),e.add_ops=function(a,b){var c;c={id:e.new_id(),ops:b},e.editors.notify(b,a,!0),e.operations_local.push(c),e.comm.notify(),e.local_storage.write()},e.comm=nbe.doc.comm(e,c,d),d("nunsaved",e.operations_local.length),e},nbe.doc.editors=function(a){var b,c,d,e;return b={},c=function(c,d,e){var f,g,h,i,j,k,l;f=[];for(j=0;j<a.operations_local.length;j++){g=a.operations_local[j].ops;for(k=0;k<g.length;k++)l=g[k],(d===l.editor_class||d==="text"&&!("editor_class"in l))&&f.push(l)}return d==="text"?(h=nbe.state.state_copy(a.state.text),nbe.state.update(null,h,null,f),i=nbe.editor.create(c,e,a),i.init(h)):d==="title"?(h=nbe.title.state_copy(a.state.title),i=nbe.title.create(c,e,a),i.init(h),i.add_external_ops(f,!1)):d==="publish"&&(h=nbe.publish.state_copy(a.state.publish),i=nbe.publish.create(c,a),i.init(h),i.add_external_ops(f,!1)),b[c]=i,i},d=function(a){delete b[a]},e=function(a,c,d){var e;for(e in b)b.hasOwnProperty(e)&&(c===null||c!==e)&&b[e].add_external_ops(a,d)},{add:c,remove:d,notify:e}},nbe.doc.local_storage=function(a,b){var c,d,e,f,g,h,i,j;return e=5e3,c=function(){return JSON.stringify({state:nbe.doc.state_serialize(a.state),server_status:a.server_status,n_operations_server:a.n_operations_server,operations_local:a.operations_local})},d=function(b){var c;c=JSON.parse(b),a.state=nbe.doc.state_deserialize(c.state),a.server_status=c.server_status,a.n_operations_server=c.n_operations_server,a.operations_local=c.operations_local},f=function(){return"/nbe/text/"+a.ids.id},g=function(){var a;a=localStorage.getItem(f()),a&&d(a)},j=function(){localStorage.setItem(f(),c())},i=null,h=function(){i===null&&(i=setTimeout(function(){j(),i=null},e))},b&&typeof localStorage=="object"?{read:g,write:h}:{read:function(){},write:function(){}}},nbe.doc.merge=function(a,b,c){var d,e,f,g,h;b=b.slice(a.n_operations_server-c);if(b.length!==0){a.n_operations_server=a.n_operations_server+b.length,nbe.doc.state_update(a.state,b);for(d=0;d<a.operations_local.length&&d<b.length;d++)if(b[d].id!==a.operations_local[d].id)break;a.operations_local=a.operations_local.slice(d),e=b.slice(d),e.length!==0&&(f={},e.forEach(function(a){f[a.id]=!0}),g=a.operations_local.filter(function(a){return!(a.id in f)}),h=[],a.operations_local.forEach(function(a){h=h.concat(a.ops)}),h=nbe.state.invert_ops(h),e.concat(g).forEach(function(a){h=h.concat(a.ops)}),a.editors.notify(h,null,!0))}},nbe.doc.html=function(a){var b,c,d,e,f;return b=a.editors.add("temp","title",{editable:!1,html_title:!1}),d=b.get_value(),a.editors.remove("temp"),c=a.editors.add("temp","text",{editable:!1}),e=c.get_html(),a.editors.remove("temp"),e=e.replace(/ data-id="[a-z0-9]+"/g,""),e=e.replace(/ style=""/g,""),f=["<!DOCTYPE html>",'<html lang="en">',"<head>",'<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />',"<title>",d,"</title>",'<style type="text/css">',nbe.css.publish,"</style>","</head>","<body>",'<div class="nbe editor">',e,"</div>","</body>","</html>"].join("\n"),f},nbe.doc.comm=function(a,b,c){var d,e,f,g,h,i,j,k,l;d=function(){k.send(JSON.stringify({type:"new",ids:a.ids}))},e=function(b){b.text==="created"?(a.server_status="established",a.local_storage.write(),h()):console.log("The id is already taken")},f=function(){k.send(JSON.stringify({type:"unknown",ids:a.ids}))},g=function(b){b.text==="noexist"?(k.close(),c("doc","noexist")):(a.state=nbe.doc.state_deserialize(b.state),a.n_operations_server=b.noperation,a.server_status="established",a.local_storage.write(),c("doc","exist"))},h=function(){k.send(JSON.stringify({type:"sync",ids:a.ids,noperations:a.n_operations_server,operations:a.operations_local})),c("nunsaved",a.operations_local.length)},i=function(b){var c;c=a.n_operations_server,nbe.doc.merge(a,b.operations,b.noperations),c!==a.n_operations_server&&h()},j=function(a){var b;b=JSON.parse(a);switch(b.type){case"new":e(b);break;case"unknown":g(b);break;case"invalid":k.close(),c("password","wrong password");break;case"sync":i(b)}},c("network","unconnected");if(b){k=nbe.doc.ws(b,j,c);if(k!==null)switch(a.server_status){case"new":d();break;case"unknown":f();break;case"established":h()}}return l=function(){b&&k!==null&&a.server_status==="established"&&h()},{notify:l}},nbe.doc.ws=function(a,b,c){var d,e,f,g,h,i,j,k;return typeof WebSocket=="undefined"&&typeof MozWebSocket!="function"?null:(d=!1,e=null,f=null,g="received",h=function(a){f=a,g==="received"&&k.readyState===k.OPEN&&(e=a,g="pending",k.send(a))},i=function(){d=!0,k.readyState!==k.CLOSED&&k.close()},j=function(){k=typeof WebSocket!="undefined"?new WebSocket(a):new MozWebSocket(a),k.onopen=function(){c("network","connected"),f!==null&&h(f)},k.onerror=function(){k.close()},k.onclose=function(){g="received",c("network","unconnected"),d||setTimeout(j,5e3)},k.onmessage=function(a){g="received",b(a.data),e!==f&&h(f)}},j(),{send:h,close:i})},nbe.doc.state_init=function(){return{text:nbe.state.deserialize(nbe.state.initial()),title:nbe.title.state_init(),publish:nbe.publish.state_init()}},nbe.doc.state_copy=function(a){return{text:nbe.state.deserialize(nbe.state.serialize(a.text)),title:nbe.title.state_copy(a.title),publish:nbe.publish.state_copy(a.publish)}},nbe.doc.state_update=function(a,b){var c;c={text:[],title:[],publish:[]},b.forEach(function(a){a.ops.forEach(function(a){var b;b="editor_class"in a?a.editor_class:"text",c[b].push(a)})}),nbe.state.update(null,a.text,null,c.text),nbe.title.state_update(a.title,c.title),nbe.publish.state_update(a.publish,c.publish)},nbe.doc.state_serialize=function(a){return JSON.stringify({text:nbe.state.serialize(a.text),title:a.title,publish:a.publish})},nbe.doc.state_deserialize=function(a){var b;return b=JSON.parse(a),{text:nbe.state.deserialize(b.text),title:b.title,publish:b.publish}},nbe.state.initial=function(){return JSON.stringify({nodes:{root:{type:"root",id:"root",parent:null,children:["line"],val:{}},line:{type:"line",id:"line",parent:"root",children:[],val:{}}}})},nbe.state.init=function(a,b){var c,d;a.state=b,a.dom=c={},c.root=nbe.state.element("root","root",b.nodes.root.val),d=function(a,b,e){var f,g;for(f=0;f<e.length;f++)g=e[f],c[g.id]=nbe.state.element(g.id,g.type,g.val),b==="line"?a.insertBefore(c[g.id],a.lastChild):a.appendChild(c[g.id]),d(c[g.id],g.type,g.children)},d(c.root,"root",b.nodes.root.children),nbe.state.reset_counter(a),a.mutation.disconnect();while(a.el_editor.firstChild)a.el_editor.removeChild(a.el_editor.firstChild);return a.el_editor.appendChild(c.root),a.mutation.observe(),a},nbe.state.clean=function(a){nbe.state.init(a,a.state),nbe.location.set(a,a.location)},nbe.state.update=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n;e=b.nodes,f=e.root,g=function(a,b,d,f){var g,h;!(a in e)&&b in e&&(g={id:a,type:d,val:f,parent:e[b].parent,children:[]},e[a]=g,h=g.parent.children.indexOf(e[b]),g.parent.children=g.parent.children.slice(0,h).concat([g]).concat(g.parent.children.slice(h)),c&&(c[a]=nbe.state.element(a,d,f),c[e[b].parent.id].insertBefore(c[a],c[b])))},h=function(a,d,f,g){var h;!(a in e)&&d in e&&(h={id:a,type:f,val:g,parent:e[d],children:[]},e[a]=h,h.parent.children.push(h),c&&(c[a]=nbe.state.element(a,f,g)),h.parent.type==="line"?(c&&c[d].insertBefore(c[a],c[d].lastChild),nbe.state.line_font_size(b,c,d,"append")):c&&c[d].appendChild(c[a]))},i=function(a){var d,f;a in e&&(d=e[a],d.children.length===0&&(d.parent.type==="line"&&nbe.state.line_font_size(b,c,d.parent.id,"remove"),delete e[a],f=d.parent.children.indexOf(d),d.parent.children=d.parent.children.slice(0,f).concat(d.parent.children.slice(f+1)),c&&(c[d.parent.id].removeChild(c[a]),delete c[a])))},j=function(a,b){a in e&&(e[a].val=b,c&&nbe.state.mutate_element(c[a],e[a].type,b))},k=function(a,b,d,g,h){var i,j,k,l,m,n;i=e[a];if(!(b in e)&&i&&i.type==="line"){j={id:b,type:"line",val:h,parent:f,children:[]},e[b]=j,c&&(c[b]=nbe.state.element(b,"line",j.val)),k=f.children.indexOf(i),k===f.children.length-1?c&&c.root.appendChild(c[b]):c&&c.root.insertBefore(c[b],c[f.children[k+1].id]),f.children=f.children.slice(0,k+1).concat([j]).concat(f.children.slice(k+1)),d&&d in e&&e[d].parent===i?l=i.children.indexOf(e[d]):l=i.children.length;for(m=l;m<i.children.length;m++)n=i.children[m],n.parent=j,c&&(c[a].removeChild(c[n.id]),c[b].insertBefore(c[n.id],c[b].lastChild));j.children=i.children.slice(l),i.children=i.children.slice(0,l),i.val=g,c&&nbe.state.mutate_element(c[a],"line",g)}},l=function(a,b,d){var g,h,i,j,k;g=e[a];if(g&&g.type==="line"){h=f.children.indexOf(g);if(h<f.children.length-1){i=f.children[h+1];for(j=0;j<i.children.length;j++)k=i.children[j],k.parent=g,c&&(c[i.id].removeChild(c[k.id]),c[a].insertBefore(c[k.id],c[a].lastChild));c&&(c.root.removeChild(c[i.id]),delete c[i.id]),f.children=f.children.slice(0,h+1).concat(f.children.slice(h+2)),delete e[i.id],g.children=g.children.concat(i.children),g.val=nbe.state.line_val_merge(b,d),c&&nbe.state.mutate_element(c[a],"line",g.val)}}},c&&a.mutation.disconnect();for(m=0;m<d.length;m++)n=d[m],n.domop==="insert"?g(n.id,n.before,n.type,n.val):n.domop==="append"?h(n.id,n.parent,n.type,n.val):n.domop==="remove"?i(n.id):n.domop==="mutate"?j(n.id,n.after):n.domop==="split"?k(n.parent,n.child,n.point,n.parentval,n.childval):n.domop==="merge"&&l(n.parent,n.parentval,n.childval);c&&(nbe.state.reset_counter(a),a.mutation.observe())},nbe.state.element=function(a,b,c){var d,e;return d={root:"div",line:"div",text:"span",img:"img",link:"a"}[b],e=document.createElement(d),e.setAttribute("data-id",a),e.classList.add("wu-"+b),b==="line"&&e.appendChild(document.createElement("br")),nbe.state.mutate_element(e,b,c),e},nbe.state.mutate_element=function(a,b,c){var d,e;d=function(b){var d;for(d=0;d<b.length;d++)b[d]in c&&a.classList.add("wu-"+c[b[d]])},e=function(b){var c;for(c=0;c<b.length;c++)a.classList.remove("wu-"+b[c])};switch(b){case"root":break;case"line":e(nbe.state.line_classes),d(["heading","text_align","list","line_spacing"]),a.style.marginLeft=c.left_margin?c.left_margin+"px":"",a.style.fontSize=c.font_size||"";break;case"text":a.textContent=c.text,a.classList[c.bold?"add":"remove"]("wu-bold"),a.classList[c.italic?"add":"remove"]("wu-italic"),a.classList[c.underline?"add":"remove"]("wu-underline"),a.classList[c.strikethrough?"add":"remove"]("wu-strikethrough"),a.style.color=c.color||"",a.style.backgroundColor=c.background_color||"",a.style.fontFamily=c.font_family||"",a.style.verticalAlign=c.vertical_align||"",a.style.fontSize=c.vertical_align?c.font_size?.8*Number(c.font_size.slice(0,c.font_size.length-2))+"px":"80%":c.font_size||"";break;case"img":a.src=c.src||"","width"in c?a.width=c.width:a.removeAttribute("width"),"height"in c?a.height=c.height:a.removeAttribute("height"),a.title=c.title||"";break;case"link":a.href=c.href}return a},nbe.state.formats={text:["bold","italic","underline","strikethrough","color","background_color","font_family","font_size","vertical_align"],line:["heading","text_align","left_margin","line_spacing","list"],default_values:{bold:"off",italic:"off",underline:"off",strikethrough:"off",color:"rgb(0, 0, 0)",background_color:"transparent",font_family:"arial",font_size:"16px",vertical_align:"baseline",heading:"none",text_align:"left",left_margin:0,line_spacing:"line_spacing_16",list:"none",edit_img:null,edit_link:null},left_margin:{step:20,max:500},font_family:["arial","courier","helvetica","times","verdana"]},nbe.state.line_font_size=function(a,b,c,d){var e,f,g,h;e=a.nodes[c],b&&(f=b[c]),d==="remove"?e.children.length===1&&(g=e.children[0],g.type==="text"&&(h=g.val.font_size,h&&(e.val.font_size=h,b&&nbe.state.mutate_element(f,"line",e.val)))):e.val.font_size&&(delete e.val.font_size,b&&nbe.state.mutate_element(f,"line",e.val))},nbe.state.reset_counter=function(a){var b,c,d,e,f,g,h;b={disc:!0,"lower-alpha":!0,"lower-roman":!0,square:!0,"upper-alpha":!0,"upper-roman":!0,ordered:!0},c=null,d=a.state.nodes.root.children;for(e=0;e<d.length;e++)f=d[e],g=f.val.list,g&&g in b?g!==c?(c=g,h=!0):h=!1:(c=null,h=!1),h?a.dom[f.id].classList.add("wu-reset-counter"):a.dom[f.id].classList.remove("wu-reset-counter")},nbe.state.copy_text_format=function(a,b){var c,d,e;c=nbe.state.formats.text;for(d=0;d<c.length;d++)e=c[d],e in a?b[e]=a[e]:delete b[e];return b},nbe.state.copy_line_format=function(a,b){var c,d,e;c=nbe.state.formats.text.concat(nbe.state.formats.line);for(d=0;d<c.length;d++)e=c[d],e in a?b[e]=a[e]:delete b[e];return b},nbe.state.line_val_merge=function(a,b){var c,d;return c={},d=function(d){d in a?c[d]=a[d]:d in b&&(c[d]=b[d])},nbe.state.formats.text.concat(nbe.state.formats.line).forEach(function(a){d(a)}),"left_margin"in a?c.left_margin=a.left_margin:delete c.left_margin,c},nbe.state.cmp_value_format=function(a,b,c){return nbe.state.formats.default_values[a]===b?!(a in c):a in c&&c[a]===b},nbe.state.cmp_text_format=function(a,b){var c,d;c=function(c){return c in a&&c in b?a[c]===b[c]:c in a?nbe.state.formats.default_values[c]===a[c]:c in b?nbe.state.formats.default_values[c]===b[c]:!0};for(d=0;d<nbe.state.formats.text.length;d++)if(!c(nbe.state.formats.text[d]))return!1;return!0},nbe.state.set_format=function(a,b,c){return nbe.state.formats.default_values[a]===b?delete c[a]:c[a]=b,c},nbe.state.line_classes=["center","right","justify","heading1","heading2","heading3","heading4","heading5","heading6","disc","lower-alpha","lower-roman","square","upper-alpha","upper-roman","ordered","line_spacing_05","line_spacing_06","line_spacing_07","line_spacing_08","line_spacing_09","line_spacing_10","line_spacing_11","line_spacing_12","line_spacing_13","line_spacing_14","line_spacing_15","line_spacing_16","line_spacing_17","line_spacing_18","line_spacing_19","line_spacing_20"],nbe.state.invert_ops=function(a){var b,c,d;b=function(a){var b;if("editor_class"in a&&(a.editor_class==="title"||a.editor_class==="publish"))b={editor_class:a.editor_class,before:a.after,after:a.before};else if(a.domop==="insert")b={domop:"remove",id:a.id,before:a.before,type:a.type,val:a.val};else if(a.domop==="append")b={domop:"remove",id:a.id,parent:a.parent,type:a.type,val:a.val};else if(a.domop==="remove"&&"before"in a)b={domop:"insert",id:a.id,before:a.before,type:a.type,val:a.val};else if(a.domop==="remove"&&"parent"in a)b={domop:"append",id:a.id,parent:a.parent,type:a.type,val:a.val};else if(a.domop==="mutate")b={domop:"mutate",id:a.id,before:a.after,after:a.before};else if(a.domop==="split"||a.domop==="merge")b={domop:"merge",parent:a.parent,child:a.child,point:a.point,parentval:a.parentval,childval:a.childval},b.domop=a.domop==="split"?"merge":"split";return b},c=[];for(d=0;d<a.length;d++)c.push(b(a[d]));return c=c.reverse(),c},nbe.state.invert_oploc=function(a){var b;return b={ops:nbe.state.invert_ops(a.ops),loc_before:a.loc_after,loc_after:a.loc_before},b},nbe.state.left_margin=function(a,b){var c,d,e;return c=20,d=b.left_margin?b.left_margin:0,a==="increment"?e=d+c:e=d>=c?d-c:d,e>0?b.left_margin=e:delete b.left_margin,e!==d},nbe.state.serialize=function(a){var b,c,d,e,f,g;b={},c=a.nodes;for(d in c)if(c.hasOwnProperty(d)){e=c[d],f={type:e.type,id:e.id,val:e.val,children:[]},e.parent&&(f.parent=e.parent.id);for(g=0;g<e.children.length;g++)f.children[g]=e.children[g].id;b[d]=f}return JSON.stringify({nodes:b})},nbe.state.deserialize=function(a){var b,c,d,e,f,g;b={},c=JSON.parse(a).nodes;for(d in c)c.hasOwnProperty(d)&&(e=c[d],b[d]={type:e.type,id:e.id,val:e.val,children:[]});for(d in c)if(c.hasOwnProperty(d)){e=c[d],f=b[d],e.parent&&(f.parent=b[e.parent]);for(g=0;g<e.children.length;g++)f.children[g]=b[e.children[g]]}return{nodes:b}},nbe.state.state_copy=function(a){return nbe.state.deserialize(nbe.state.serialize(a))},nbe.location.get=function(a){var b,c,d,e;return b={},c=window.getSelection().getRangeAt(0),d=function(a,b){var c;return a.classList?c=a:c=a.parentNode,{container:c.getAttribute("data-id"),offset:b}},e=function(b){var c,d,e;if(b.container==="editor"){c=a.state.nodes.root;if(b.offset===0)return{container:c.children[0].id,offset:0};d=c;while(d.children.length>0)d=d.children[d.children.length-1];return{container:d.id,offset:d.type==="text"?d.val.text.length:1}}return b.container==="root"?{container:a.state.nodes.root.children[b.offset].id,offset:0}:(b.container in a.state.nodes&&(d=a.state.nodes[b.container],e=b.offset),e===0&&d.type==="line"?b:e===0?nbe.location.loc_previous(d).start:d.type==="line"||d.type==="link"?nbe.location.loc_end(d.children[e-1]):b)},b.start=e(d(c.startContainer,c.startOffset)),c.collapsed?b.collapsed=!0:(b.collapsed=!1,b.end=e(d(c.endContainer,c.endOffset))),a.location=b,b},nbe.location.set=function(a,b){var c,d,e,f,g;c=function(b,c){var d,e,f,g,h;return d=a.state.nodes[b],d?(d.type==="img"?(e=d.parent.id,f=d.parent.children.indexOf(d)+1):(e=b,f=c),g=a.dom[e],h=a.state.nodes[e],h.type==="text"&&(g=g.firstChild,f>h.val.length&&(f=h.val.length)),{container:g,offset:f}):null},a.mutation.disconnect(),b&&(d=c(b.start.container,b.start.offset),b.collapsed?e=d:e=c(b.end.container,b.end.offset),d&&e?(f=document.createRange(),f.setStart(d.container,d.offset),f.setEnd(e.container,e.offset),g=window.getSelection(),g.removeAllRanges(),g.addRange(f)):b=null),a.location=b,b?(nbe.location.focus(a),nbe.location.scroll(a),a.inputs.notify()):nbe.location.blur(a),a.mutation.observe()},nbe.location.focus=function(a){a.el_editor.focus()},nbe.location.scroll=function(a){var b,c,d,e,f,g,h,i,j;b=a.el_editor,c=b.parentNode.classList.contains("editor_container")?b.parentNode:b,d=function(a){var b;b=0;while(a)b+=a.offsetTop,a=a.offsetParent;return b},e=a.location.collapsed?a.location.start:a.location.end,f=a.dom[e.container],g=d(f),h=d(c),i=g-h,c.scrollTop>i?c.scrollTop=i:(j=i+f.offsetHeight-c.offsetHeight,c.scrollTop<j&&(c.scrollTop=j))},nbe.location.blur=function(a){a.el_editor.blur()},nbe.location.format=function(a){var b;return b={},nbe.location.format_line(a,b),nbe.location.format_text(a,b),nbe.location.format_img_link(a,b),a.format=b,a.inputs.notify(),b},nbe.location.format_update=function(a){return nbe.location.format_line(a,a.format),nbe.location.format_text(a,a.format),nbe.location.format_img_link(a,a.format),a.inputs.notify(),a.format},nbe.location.format_text=function(a,b){var c,d,e,f,g,h,i,j,k;return c=function(a){a=nbe.location.previous_node(a);while(a!==null&&a.type!=="text"&&a.type!=="line")a=nbe.location.previous_node(a);return a},d=function(a){a=nbe.location.next_node(a);while(a!==null&&a.type!=="text"&&a.type!=="line")a=nbe.location.next_node(a);return a},e=function(a){var b;return b=d(a),b&&b.type==="text"?b:a},f=function(a){var b,e;return b=c(a),b.type==="text"?b:(e=d(a),e&&e.type==="text"?e:b)},a.location===null?g={}:(h=a.location.collapsed?a.location.start:a.location.end,i=a.state.nodes[h.container],i.type==="text"&&h.offset>0?j=i:i.type==="text"?(k=nbe.location.previous_node(i),k.type==="text"?j=k:j=i):i.type==="line"?j=e(i):j=f(i),g=j.val),nbe.state.copy_text_format(g,b),b},nbe.location.format_line=function(a,b){var c,d,e,f;return c=function(a){while(a.type!=="line")a=a.parent;return a.val},a.location===null?d={}:(e=a.location.collapsed?a.location.start:a.location.end,f=a.state.nodes[e.container],d=c(f)),nbe.state.copy_line_format(d,b),b},nbe.location.format_img_link=function(a,b){var c,d,e,f,g,h,i,j,k;c=function(a){a&&a.type==="img"&&i===null&&(i=a),j===null&&(a&&a.type==="link"?j=a:a&&a.parent&&a.parent.type==="link"&&(j=a.parent))};if(a.location===null)return null;a.location.collapsed?(d=e=a.state.nodes[a.location.start.container],f=a.location.start.offset):(d=a.state.nodes[a.location.start.container],e=a.state.nodes[a.location.end.container],f=a.location.end.offset),g=e,h=!0,i=null,j=null;while(h)c(g),g===d?h=!1:g=nbe.location.previous_node(g);return e.type==="text"&&f<e.val.text.length||(k=nbe.location.next_node(e),c(k)),i&&(b.edit_img={id:i.id},nbe.lib.partial_copy(i.val,b.edit_img,["src","width","height","title"])),j&&(b.edit_link={id:j.id,href:j.val.href}),b},nbe.location.get_format=function(a){nbe.location.get(a),nbe.location.format(a)},nbe.location.previous_node=function(a){var b,c;return b=function(a){return a.children.length===0?a:b(a.children[a.children.length-1])},a.parent?(c=a.parent.children.indexOf(a),c>0?b(a.parent.children[c-1]):a.parent):null},nbe.location.next_node=function(a){var b;return b=function(a){var c;return a.parent?(c=a.parent.children.indexOf(a),c<a.parent.children.length-1?a.parent.children[c+1]:b(a.parent)):null},a.children.length===0?b(a):a.children[0]},nbe.location.insert_after=function(a,b){var c,d;return c=a.state.nodes[b],d=c.parent.children.indexOf(c),d<c.parent.children.length-1?{domop:"insert",before:c.parent.children[d+1].id}:{domop:"append",parent:c.parent.id}},nbe.location.parent_line=function(a,b){var c;c=a.state.nodes[b];while(c&&c.type!=="line")c=c.parent;return c},nbe.location.op_remove=function(a){var b,c;return b={domop:"remove",id:a.id,type:a.type,val:a.val},c=a.parent.children.indexOf(a),c===a.parent.children.length-1?b.parent=a.parent.id:b.before=a.parent.children[c+1].id,b},nbe.location.loc_previous=function(a){var b,c,d;return b=function(a){return a.type==="text"?{container:a.id,offset:a.val.text.length}:a.type==="link"?b(a.children[a.children.length-1]):a.type==="line"?a.children.length===0?{container:a.id,offset:0}:b(a.children[a.children.length-1]):{container:a.id,offset:1}},c=a.parent.children.indexOf(a),c>0?(d=a.parent.children[c-1],{start:b(d),collapsed:!0}):a.type==="line"?{start:{container:a.id,offset:0},collapsed:!0}:a.parent.type==="line"?{start:{container:a.parent.id,offset:0},collapsed:!0}:nbe.location.loc_previous(a.parent)},nbe.location.loc_end=function(a){return a.type==="text"?{container:a.id,offset:a.val.text.length}:a.type==="link"?nbe.location.loc_end(a.children[a.children.length-1]):a.type==="line"?a.children.length===0?{container:a.id,offset:0}:nbe.location.loc_end(a.children[a.children.length-1]):{container:a.id,offset:1}},nbe.location.line=function(a){while(a.type!=="line")a=a.parent;return a},nbe.location.lines=function(a){var b,c,d,e,f,g,h,i,j;return b=[],a.location&&(c=a.state.nodes,d=a.location.start,e=a.location.collapsed?d:a.location.end,f=nbe.location.parent_line(a,d.container),g=nbe.location.parent_line(a,e.container),h=f.parent.children,i=h.indexOf(f),j=h.indexOf(g),b=h.slice(i,j+1)),b},nbe.location.next_sibling=function(a){var b;return b=a.parent.children.indexOf(a),b<a.parent.children.length-1?a.parent.children[b+1]:null},nbe.location.previous_sibling=function(a){var b;return b=a.parent.children.indexOf(a),b>0?a.parent.children[b-1]:null},nbe.location.in_text=function(a){return a&&a.node.type==="text"&&a.offset<a.node.val.text.length&&a.offset>0},nbe.location.in_link=function(a){var b;return a.node.parent.type!=="link"?!1:(b=a.node.parent.children.indexOf(a.node),b===a.node.parent.children.length-1?a.node.type==="text"?nbe.location.in_text(a):!1:!0)},nbe.location.previous_location=function(a,b){var c,d,e,f;return c=function(a){return a.type==="text"?{container:a.id,offset:a.val.text.length}:a.type==="link"?c(a.children[a.children.length-1]):a.type==="line"?a.children.length===0?{container:a.id,offset:0}:c(a.children[a.children.length-1]):{container:a.id,offset:1}},d=a.state.nodes[b.container],d.type==="text"&&b.offset>1?{container:d.id,offset:b.offset-1}:d.type==="line"?(e=nbe.location.previous_sibling(d),e?c(e):b):d.parent.type==="line"?(e=nbe.location.previous_sibling(d),e?c(e):{container:d.parent.id,offset:0}):(e=nbe.location.previous_sibling(d),e?c(e):(f=nbe.location.previous_sibling(d.parent),f?c(f):{container:d.parent.parent.id,offset:0}))},nbe.location.first_child=function(a){return a.children.length===0?null:a.children[0]},nbe.location.last_child=function(a){return a.children.length===0?null:a.children[a.children.length-1]},nbe.location.split_merge_point=function(a){var b,c;return a.node.type==="line"?(c=nbe.location.first_child(a.node),b=!1):a.node.parent.type==="link"?(c=a.node.parent,b=!nbe.location.in_link(a)):(c=a.node,b=!nbe.location.in_text(a)),b&&(c=nbe.location.next_sibling(c)),c?c.id:null},nbe.location.loc_to_point=function(a,b){return{node:a.state.nodes[b.container],offset:b.offset}},nbe.location.item_to_loc=function(a){var b,c;return c=a.item,b=c.type==="text"?c.val.text.length:1,{container:a.id,offset:b}},nbe.location.text_nodes_in_line=function(a){var b,c,d,e;b=[];for(c=0;c<a.children.length;c++){d=a.children[c];if(d.type==="text")b.push(d);else if(d.type==="link")for(e=0;e<d.children.length;e++)d.children[e].type==="text"&&b.push(d.children[e])}return b},nbe.ops.append=function(a,b,c){var d,e,f,g,h,i;d=[],e=null,f=function(b,c,d){var g,h,i;for(g=0;g<d.length;g++)h=a.new_id(),i=d[g],b.push({domop:"append",id:h,parent:c,type:i.type,val:i.val}),e={id:h,item:i},f(b,h,i.children)};for(g=0;g<c.length;g++)h=c[g],i=a.new_id(),d.push({domop:"append",id:i,parent:b,type:h.type,val:h.val}),e={id:i,item:h},f(d,i,h.children);return d.length>0?{ops:d,loc:nbe.location.item_to_loc(e)}:null},nbe.ops.insert_before=function(a,b,c){var d,e,f,g,h,i;d=[],e=null,f=function(b,c,d){var g,h,i;for(g=0;g<d.length;g++)h=a.new_id(),i=d[g],b.push({domop:"append",id:h,parent:c,type:i.type,val:i.val}),e={id:h,item:i},f(b,h,i.children)};for(g=0;g<c.length;g++)h=c[g],i=a.new_id(),d.push({domop:"insert",id:i,before:b,type:h.type,val:h.val}),e={id:i,item:h},f(d,i,h.children);return d.length>0?{ops:d,loc:nbe.location.item_to_loc(e)}:null},nbe.ops.insert_after=function(a,b,c){var d,e;return d=a.state.nodes[b],e=nbe.location.next_sibling(d),e?nbe.ops.insert_before(a,e.id,c):nbe.ops.append(a,d.parent,c)},nbe.ops.remove=function(a){var b,c;return b=function(a,b){var c;return c=a.parent.children.indexOf(a),c===a.parent.children.length-1?b.parent=a.parent.id:b.before=a.parent.children[c+1].id,b},c=function(a,d){var e;for(e=0;e<a.children.length;e++)c(a.children[e],d);return d.push(b(a,{domop:"remove",id:a.id,type:a.type,val:a.val})),d},c(a,[])},nbe.ops.text=function(a,b,c,d){var e,f,g,h,i,j;return e=b?b.node:c.node,f={domop:"mutate",id:e.id,before:e.val,after:nbe.lib.clone(e.val)},g=[f],h=null,d?(f.after.text=e.val.text.slice(c.offset),b&&(i={domop:"insert",id:a.new_id(),before:e.id,type:"text",val:nbe.lib.clone(e.val)},i.val.text=e.val.text.slice(0,b.offset),g.push(i),h={container:i.id,offset:b.offset}),j=nbe.ops.insert_before(a,e.id,d),j&&(g=g.concat(j.ops),j.loc&&(h=j.loc))):(f.after.text=(b?e.val.text.slice(0,b.offset):"")+(c?e.val.text.slice(c.offset):""),h=b?{container:e.id,offset:b.offset}:null),{ops:g,loc:h}},nbe.ops.link=function(a,b,c,d){var e,f,g,h,i,j,k,l,m;e=function(a){var b,c;b=[];for(c=0;c<a.length;c++)a[c].type!=="link"?b.push(a[c]):b=b.concat(a[c].children);return b},d&&(d=e(d)),f=b?b.node.parent:c.node.parent,g=b?f.children.indexOf(b.node)+1:0,c?(h=!nbe.location.in_text(c),i=f.children.indexOf(c.node)+(h?1:0)):(h=!0,i=f.children.length),j=[],k=null;if(i<g)l=nbe.ops.text(a,b,c,d),j=j.concat(l.ops),k=l.loc;else{nbe.location.in_text(b)?(l=nbe.ops.text(a,b,null,null),j=j.concat(l.ops),k=l.loc):k=b?{container:b.node.id,offset:b.offset}:null;for(m=g;m<i;m++)j=j.concat(nbe.ops.remove(f.children[m]));h?d&&(l=nbe.ops.insert_after(a,c.node.id,d),l&&(j=j.concat(l.ops),l.loc&&(k=l.loc))):(l=nbe.ops.text(a,null,c,d),j=j.concat(l.ops),l.loc&&(k=l.loc))}return{ops:j,loc:k}},nbe.ops.line=function(a,b,c,d){var e,f,g,h,i,j,k,l,m;b?b.node.type==="line"?(e=b.node,f=0,g=null):b.node.parent.type==="line"?(e=b.node.parent,f=e.children.indexOf(b.node)+1,g=nbe.location.in_text(b)?b.node:null):b.node.parent.type==="link"&&(e=b.node.parent.parent,f=e.children.indexOf(b.node.parent)+1,g=nbe.location.in_link(b)?b.node.parent:null):(f=0,g=null),c?c.node.type==="line"?(e=c.node,h=0,i=null):c.node.parent.type==="line"?(e=c.node.parent,h=e.children.indexOf(c.node)+(nbe.location.in_text(c)?0:1),i=nbe.location.in_text(c)?c.node:null):c.node.parent.type==="link"&&(e=c.node.parent.parent,h=e.children.indexOf(c.node.parent)+(nbe.location.in_link(c)?0:1),i=nbe.location.in_link(c)?c.node.parent:null):(h=e.children.length,i=null),j=[],k=b?{container:b.node.id,offset:b.offset}:{container:e.id,offset:0};if(h<f)g.type==="text"?l=nbe.ops.text(a,b,c,d):l=nbe.ops.link(a,b,c,d),j=j.concat(l.ops),l.loc&&(k=l.loc);else{g&&(g.type==="text"?l=nbe.ops.text(a,b,null,null):l=nbe.ops.link(a,b,null,null),j=j.concat(l.ops),l.loc&&(k=l.loc));for(m=f;m<h;m++)j=j.concat(nbe.ops.remove(e.children[m]));l=null,i?i.type==="text"?l=nbe.ops.text(a,null,c,d):l=nbe.ops.link(a,null,c,d):d&&(h===e.children.length?l=nbe.ops.append(a,e.id,d):h===0&&c.node.children.length>0?l=nbe.ops.insert_before(a,c.node.children[0].id,d):l=nbe.ops.insert_after(a,c.node.id,d)),l&&(j=j.concat(l.ops),l.loc&&(k=l.loc))}return{ops:j,loc:k}},nbe.ops.root=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;e=nbe.location.line(b.node),f=nbe.location.line(c.node),g=e.parent,h=g.children.indexOf(e),i=g.children.indexOf(f),j=[],k=null,l=function(a){a&&(j=j.concat(a.ops),a.loc&&(k=a.loc))},m=function(a){a&&(j=j.concat(a.ops))};if(h===i)d===null?l(nbe.ops.line(a,b,c,null)):d.length===1?l(nbe.ops.line(a,b,c,d[0].children)):(m(nbe.ops.line(a,b,c,d[0].children)),n=a.new_id(),q=nbe.location.split_merge_point(c),o=nbe.lib.clone(e.val),p=nbe.state.copy_line_format(a.format,{}),b.node===e?delete o.heading:delete p.heading,j.push({domop:"split",parent:e.id,child:n,point:q,parentval:o,childval:p}),k={container:n,offset:0},q?l(nbe.ops.insert_before(a,q,d[d.length-1].children)):l(nbe.ops.append(a,n,d[d.length-1].children)),m(nbe.ops.insert_before(a,n,d.slice(1,d.length-1))));else{for(r=h+1;r<i;r++)j=j.concat(nbe.ops.remove(g.children[r]));d===null?(l(nbe.ops.line(a,b,null,null)),m(nbe.ops.line(a,null,c,null)),j.push({domop:"merge",parent:e.id,child:f.id,point:nbe.location.split_merge_point(c),parentval:e.val,childval:f.val})):d.length===1?(l(nbe.ops.line(a,b,null,null)),s=d[0].children,l(nbe.ops.line(a,null,c,s)),t=s.length===0?nbe.location.split_merge_point(c):s[0].id,j.push({domop:"merge",parent:e.id,child:f.id,point:t,parentval:e.val,childval:f.val})):(m(nbe.ops.line(a,b,null,d[0].children)),m(nbe.ops.insert_before(a,f.id,d.slice(1,d.length-1))),l(nbe.ops.line(a,null,c,d[d.length-1].children)))}return{ops:j,loc:k}},nbe.ops.modified=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;c=a.state.nodes,d=function(a,b){var e,h,i;e=c[a];for(h=0;h<e.children.length;h++)i=e.children[h],f(i.id)?b=b.concat(nbe.ops.remove(i)):i.type==="text"?b=g(i,b):i.type==="link"&&(b=d(i.id,b));return b},e=function(b){var c;c=a.dom[b];while(c!==null&&(!c.getAttribute||c.getAttribute("data-id")!=="root"))c=c.parentNode;return c!==null},f=function(b){return e(b)?c[b].type==="text"?a.dom[b].textContent==="":!1:!0},g=function(b,c){var d,e;return d=a.dom[b.id],b.val.text!==d.textContent&&(e={domop:"mutate",id:b.id,before:b.val,after:nbe.lib.clone(b.val)},e.after.text=d.textContent,c.push(e)),c},h=function(b,d){var e,g,h,i,j,k,l,m,n,o,p;if(f(b))return d;e=a.dom[b],g=function(a,d){var e;return a.childNodes.length===d?null:(e=a.childNodes[d],e.getAttribute&&e.getAttribute("data-id")?(b=e.getAttribute("data-id"),c[b].type==="text"&&e.textContent===""?g(a,d+1):b):g(a,d+1))},h=function(a,b){var c;return b===-1?null:(c=a.childNodes[b],c.getAttribute&&c.getAttribute("data-id")?c.getAttribute("data-id"):h(a,b-1))},i=function(a,b){var d,e,f,i;return d=null,e=h(a,b),e&&(f=c[e],f.type==="text"&&(d=nbe.lib.clone(f.val))),d===null&&(i=g(a,b),i&&(f=c[i],f.type==="text"&&(d=nbe.lib.clone(f.val)))),d===null?{}:d};for(j=0;j<e.childNodes.length;j++){k=e.childNodes[j];if(!k.classList||!k.classList.contains("nbe"))l=k.textContent,l!==""&&(m=i(e,j),m.text=l,n=a.new_id(),o={id:n,type:"text",val:m},p=g(e,j),p?(o.domop="insert",o.before=p):(o.domop="append",o.parent=b),d.push(o))}return d},i=function(a,b){var e,f,g;e=c[a],b=d(a,b),b=h(a,b);for(f=0;f<e.children.length;f++)g=e.children[f],g.type==="link"&&(b=h(g.id,b));return b},j=function(){var b,d,e;return b=null,a.location&&(b={container:a.location.start.container,offset:a.location.start.offset},f(b.container)?b=null:(d=c[b.container],d.type==="text"&&(e=a.dom[b.container],b.offset=Math.min(b.offset+1,e.textContent.length)))),b},k=[];for(l=0;l<b.length;l++)k=i(b[l],k);return m=j(),m?n={ops:k,loc:m}:n={ops:k,loc_after:null},n},nbe.events.add_event_listeners=function(a){var b;b=a.el_editor,b.addEventListener("click",function(b){nbe.location.get_format(a)},!1),b.addEventListener("touchend",function(b){setTimeout(function(){nbe.location.get_format(a)},0)},!1),b.addEventListener("keydown",function(b){if(b.which&&b.keyCode>=37&&b.keyCode<=40)nbe.location.get_format(a);else if(b.keyCode===8)a.trigger("delete",null),b.preventDefault();else if(b.keyCode===9)a.trigger("tab",null),b.preventDefault();else if(b.keyCode===13)a.trigger("newline",null),b.preventDefault();else if(b.ctrlKey||b.metaKey)b.keyCode===65?(a.trigger("select",null),b.preventDefault()):b.keyCode===86?a.trigger("paste",null):b.keyCode!==88&&b.keyCode===90&&(a.trigger("undo",b.shiftKey?"redo":"undo"),b.preventDefault())},!1),b.addEventListener("keypress",function(b){var c;b.charCode===0&&b.keyCode>=37&&b.keyCode<=40?nbe.location.get_format(a):!b.ctrlKey&&!b.metaKey&&b.keyCode!==8&&b.keyCode!==9&&b.keyCode!==13&&(c=String.fromCharCode(b.charCode?b.charCode:b.which),a.trigger("text",c),b.preventDefault())},!1),b.addEventListener("keyup",function(b){b.keyCode>=37&&b.keyCode<=40&&nbe.location.get_format(a)},!1),b.addEventListener("mousedown",function(a){},!1),b.addEventListener("mouseup",function(b){nbe.location.get_format(a)},!1),b.addEventListener("mouseout",function(a){},!1),b.addEventListener("focus",function(b){a.focus=!0},!1),b.addEventListener("blur",function(b){a.focus=!1},!1),b.addEventListener("select",function(b){a.trigger("select",null)},!1),b.addEventListener("paste",function(b){a.trigger("paste",null)},!1),b.addEventListener("cut",function(b){a.trigger("cut",null)},!1),a.mutation=nbe.events.observer(a),a.mutation.supported||(a.mutation=nbe.events.subtree(a))},nbe.events.observer=function(a){var b,c,d,e,f,g;return b=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,c=typeof b!="undefined",c&&(d=new b(function(b){a.trigger("observer",b)})),e={childList:!0,characterData:!0,subtree:!0},f=function(){d.observe(a.el_editor,e)},g=function(){d.disconnect()},{observe:f,disconnect:g,supported:c}},nbe.events.subtree=function(a){var b,c,d,e,f;return b=!1,c=[],d=null,a.el_editor.addEventListener("DOMSubtreeModified",function(e){b&&(c.push(e),d||(d=setTimeout(function(){a.trigger("subtree",c),d=null,c=[]},0)))},!1),e=function(){b=!0},f=function(){b=!1},{observe:e,disconnect:f,supported:!0}},nbe.triggers.trigger=function(a,b,c){var d,e;switch(b){case"text":d=nbe.triggers.text(a,c);break;case"insertion":d=nbe.triggers.insertion(a,c);break;case"bold":case"underline":case"italic":case"strikethrough":case"color":case"background_color":case"font_family":case"vertical_align":case"font_size":case"heading":case"text_align":case"line_spacing":case"list":d=nbe.triggers.format(a,b,c);break;case"left_margin":d=nbe.triggers.left_margin(a,c);break;case"tab":d=nbe.triggers.tab(a);break;case"delete":d=nbe.triggers.del(a);break;case"newline":d=nbe.triggers.newline(a);break;case"img":d=nbe.triggers.img(a,c);break;case"link":d=nbe.triggers.link(a,c);break;case"cut":nbe.triggers.cut(a),d="break";break;case"paste":nbe.triggers.paste(a),d="break";break;case"undo":a.undo.trigger("undo",c),d=null;break;case"observer":d=nbe.triggers.observer(a,c);break;case"subtree":d=nbe.triggers.subtree(a,c);break;case"select":nbe.triggers.select(a),d="break";break;default:d=null}return d==="break"?d:d===null||d.ops.length===0?null:(e="loc_after"in d?d.loc_after:{start:d.loc,collapsed:!0},{ops:d.ops,loc_before:a.location,loc_after:e})},nbe.triggers.format=function(a,b,c){return nbe.state.set_format(b,c,a.format),a.location===null?null:a.location.collapsed?nbe.triggers.format_collapsed(a,b,c):nbe.state.formats.text.indexOf(b)!==-1?nbe.triggers.text_format(a,b,c):nbe.triggers.line_format(a,b,c)},nbe.triggers.format_collapsed=function(a,b,c){var d,e,f,g,h,i;d=nbe.location.parent_line(a,a.location.start.container),e=[];if(!nbe.state.cmp_value_format(b,c,d.val)&&(nbe.state.formats.text.indexOf(b)!==-1&&d.children.length===0||nbe.state.formats.line.indexOf(b)!==-1)){f={domop:"mutate",id:d.id,before:d.val},f.after=nbe.state.set_format(b,c,nbe.state.copy_line_format(d.val,{})),e.push(f);if(b==="heading"&&c!=="none"){g=nbe.location.text_nodes_in_line(d);for(h=0;h<g.length;h++)i=g[h],nbe.state.cmp_value_format("font_size",nbe.state.formats.default_values.font_size,i.val)||(f={domop:"mutate",id:i.id,before:i.val},f.after=nbe.state.set_format("font_size",nbe.state.formats.default_values.font_size,nbe.state.copy_text_format(i.val,{})),f.after.text=i.val.text,e.push(f));delete f.after.list}}return{ops:e,loc_after:a.location}},nbe.triggers.text_format=function(a,b,c){var d,e,f,g,h,i,j,k,l;return nbe.state.set_format(b,c,a.format),a.location===null||a.location.collapsed?null:(d=a.state.nodes,e=a.location.start,f=a.location.end,g={start:e,end:f,collapsed:!1},h=function(e,f,h){var i,j,k,l,m,n;return i=[],j=d[e],j.type==="text"&&!nbe.state.cmp_value_format(b,c,j.val)&&(k=h==="infinite"?j.val.text.length:h,f!==k&&(l={domop:"mutate",id:e,before:j.val},l.after=nbe.state.set_format(b,c,nbe.state.copy_text_format(j.val,{})),l.after.text=j.val.text.slice(f,k),i.push(l),h!=="infinite"&&(g.end={container:e,offset:k-f}),f>0&&(m={domop:"insert",id:a.new_id(),before:e,type:"text",val:nbe.state.copy_text_format(j.val,{})},m.val.text=j.val.text.slice(0,f),i.push(m),g.start={container:m.id,offset:f}),k<j.val.text.length&&(n=nbe.location.insert_after(a,e),n.id=a.new_id(),n.type="text",n.val=nbe.state.copy_text_format(j.val,{}),n.val.text=j.val.text.slice(k),i.push(n)))),i},i=function(a,e){var f,g,h;f=[],g=nbe.location.previous_node(d[e]);while(g&&g.id!==a)g.type==="text"&&!nbe.state.cmp_value_format(b,c,g.val)&&(h={domop:"mutate",id:g.id,before:g.val},h.after=nbe.state.set_format(b,c,nbe.state.copy_text_format(g.val,{})),h.after.text=g.val.text,f.push(h)),g=nbe.location.previous_node(g);return f},j=function(d,e){var f,g;return f=nbe.location.lines(a),g=[],f.forEach(function(a){var d;nbe.state.cmp_value_format(b,c,a.val)||(d={domop:"mutate",id:a.id,before:a.val},d.after=nbe.state.set_format(b,c,nbe.state.copy_line_format(a.val,{})),g.push(d))}),g},e.container===f.container?(k=h(e.container,e.offset,f.offset),l={container:e.container,offset:f.offset-e.offset}):(k=h(e.container,e.offset,"infinite"),k=k.concat(h(f.container,0,f.offset)),k=k.concat(i(e.container,f.container)),k=k.concat(j(e.container,f.container)),l=f),{ops:k,loc_after:g})},nbe.triggers.line_format=function(a,b,c){var d,e;return d=nbe.location.lines(a),e=[],d.forEach(function(a){var d;nbe.state.cmp_value_format(b,c,a.val)||(d={domop:"mutate",id:a.id,before:a.val},d.after=nbe.state.set_format(b,c,nbe.state.copy_line_format(a.val,{})),e.push(d),b==="heading"&&c!=="none"&&(nbe.location.text_nodes_in_line(a).forEach(function(a){nbe.state.cmp_value_format("font_size",nbe.state.formats.default_values.font_size,a.val)||(d={domop:"mutate",id:a.id,before:a.val},d.after=nbe.state.set_format("font_size",nbe.state.formats.default_values.font_size,nbe.state.copy_text_format(a.val,{})),d.after.text=a.val.text,e.push(d))}),delete d.after.list))}),{ops:e,loc_after:a.location}},nbe.triggers.left_margin=function(a,b){var c,d;return a.location===null?null:(c=nbe.location.lines(a),d=[],c.forEach(function(a){var c,e,f;c="left_margin"in a.val?a.val.left_margin:0,e=c+(b==="increment"?1:-1)*nbe.state.formats.left_margin.step,e>=0&&e<=nbe.state.formats.left_margin.max&&(f={domop:"mutate",id:a.id,before:a.val},f.after=nbe.state.set_format("left_margin",e,nbe.state.copy_line_format(a.val,{})),d.push(f))}),{ops:d,loc_after:a.location})},nbe.triggers.text=function(a,b){var c,d,e,f,g;return a.location?(c=a.location,c.collapsed?nbe.triggers.text_collapsed(a,b):(d=nbe.location.loc_to_point(a,c.start),e=nbe.location.loc_to_point(a,c.end),f=nbe.state.copy_text_format(a.format,{}),f.text=b,g=[{type:"line",val:{},children:[{type:"text",val:f,children:[]}]}],nbe.ops.root(a,d,e,g))):null},nbe.triggers.text_collapsed=function(a,b){var c,d,e,f,g,h;return c=10,d=nbe.location.loc_to_point(a,a.location.start),e=d.node,e.type==="text"&&e.val.text.length<c&&(d.offset<e.val.text.length||e.parent.type==="line")&&nbe.state.cmp_text_format(e.val,a.format)?(f={domop:"mutate",id:e.id,before:e.val,after:nbe.state.copy_text_format(e.val,{})},f.after.text=e.val.text.slice(0,d.offset)+b+e.val.text.slice(d.offset),{ops:[f],loc:{container:e.id,offset:d.offset+b.length}}):(g=nbe.state.copy_text_format(a.format,{}),g.text=b,h=[{type:"line",val:{},children:[{type:"text",val:g,children:[]}]}],nbe.ops.root(a,d,d,h))},nbe.triggers.del=function(a){var b,c,d,e,f;return a.location?(b=a.location,c=a.state.nodes[b.start.container],c.type==="line"&&"left_margin"in c.val&&b.collapsed?nbe.triggers.left_margin(a,"decrement"):(b.collapsed?(d=nbe.location.previous_location(a,b.start),e=nbe.location.loc_to_point(a,d),f=nbe.location.loc_to_point(a,b.start)):(e=nbe.location.loc_to_point(a,b.start),f=nbe.location.loc_to_point(a,b.end)),nbe.ops.root(a,e,f,null))):null},nbe.triggers.tab=function(a){var b,c;return a.location?(b=a.state.nodes[a.location.start.container],b.type==="line"?c=nbe.triggers.left_margin(a,"increment"):c=nbe.triggers.text(a," "),c):null},nbe.triggers.newline=function(a){var b,c,d,e;return a.location?(b=a.location,b.collapsed?c=d=nbe.location.loc_to_point(a,b.start):(c=nbe.location.loc_to_point(a,b.start),d=nbe.location.loc_to_point(a,b.end)),e=[{type:"line",val:{},children:[]},{type:"line",val:{},children:[]}],nbe.ops.root(a,c,d,e)):null},nbe.triggers.img=function(a,b){var c,d,e,f,g,h,i,j;return"id"in b&&b.id in a.state.nodes?(c=a.state.nodes[b.id],d={domop:"mutate",id:b.id,before:c.val,after:nbe.lib.clone(b)},delete d.after.id,e={ops:[d],loc_after:a.location}):a.location?(f=a.location,f.collapsed?g=h=nbe.location.loc_to_point(a,f.start):(g=nbe.location.loc_to_point(a,f.start),h=nbe.location.loc_to_point(a,f.end)),i=nbe.lib.clone(b),j=[{type:"line",val:{},children:[{type:"img",val:i,children:[]}]}],e=nbe.ops.root(a,g,h,j)):e=null,e},nbe.triggers.link=function(a,b){var c,d,e,f,g,h,i,j;return"id"in b&&b.id in a.state.nodes?(c=a.state.nodes[b.id],d={domop:"mutate",id:b.id,before:c.val,after:{href:b.href}},e={ops:[d],loc_after:a.location}):a.location?(f=a.location,f.collapsed?g=h=nbe.location.loc_to_point(a,f.start):(g=nbe.location.loc_to_point(a,f.start),h=nbe.location.loc_to_point(a,f.end)),i={type:"link",val:{href:b.href},children:b.insertion},j=[{type:"line",val:{},children:[i]}],e=nbe.ops.root(a,g,h,j)):e=null,e},nbe.triggers.paste=function(a){var b;b=function(b){a.trigger("insertion",b)},nbe.paste.clipboard(b)},nbe.triggers.cut=function(a){a.mutation.disconnect(),setTimeout(function(){nbe.state.clean(a),a.location.collapsed||a.trigger("delete",null),a.mutation.observe()},0)},nbe.triggers.select=function(a){var b,c,d,e;b=nbe.location.last_child(a.state.nodes.root),c=nbe.location.next_node(b);while(c!==null)b=c,c=nbe.location.next_node(b);b.type==="text"?d=b.val.text.length:b.type==="line"?d=0:d=1,e={start:{container:"line",offset:0},end:{container:b.id,offset:d},collapsed:!1},nbe.location.set(a,e)},nbe.triggers.insertion=function(a,b){var c,d,e;return a.location?(c=a.location,c.collapsed?d=e=nbe.location.loc_to_point(a,c.start):(d=nbe.location.loc_to_point(a,c.start),e=nbe.location.loc_to_point(a,c.end)),nbe.ops.root(a,d,e,b)):null},nbe.triggers.observer=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;return c=a.state.nodes,d=a.dom,e=[],f=[],g=[],h=function(a,b){var c;return c=a.indexOf(b),c===-1&&a.push(b),c===-1},i=function(a,b){var c;return c=a.indexOf(b),c!==-1&&a.splice(c,1),c!==-1},j=function(a){h(e,a)},k=function(a){var b;b=i(e,a),b||h(f,a)},l=function(a){e.indexOf(a)===-1&&h(g,a)},b.forEach(function(a){var b;if(a.type==="characterData")l(a.target);else if(a.type==="childList"){for(b=0;b<a.addedNodes.length;b++)j(a.addedNodes[b]);for(b=0;b<a.removedNodes.length;b++)k(a.removedNodes[b])}}),m=function(a,b){var c;while(a!==null&&(!a.classList||!a.classList.contains("line")))a=a.parentNode;a&&(c=a.getAttribute("data-id"),b[c]=!0)},n={},e.concat(f).concat(g).forEach(function(a){m(a,n)}),o=nbe.ops.modified(a,Object.keys(n)),nbe.state.clean(a),o},nbe.triggers.subtree=function(a,b){var c,d,e,f;c=function(a,b){while(a!==null&&(!a.classList||!a.classList.contains("line")))a=a.parentNode;return a!==null&&(b[a.getAttribute("data-id")]=!0),b},d={};for(e=0;e<b.length;e++)c(b[e].target?b[e].target:null,d);return f=nbe.ops.modified(a,Object.keys(d)),nbe.state.clean(a),f},nbe.editor.create=function(a,b,c){var d,e,f,g;return d=document.createElement("div"),d.classList.add("wu-editor"),d.setAttribute("data-id","editor"),e=function(a,b){a=a.filter(function(a){return!("editor_class"in a)}),nbe.state.update(g,g.state,g.dom,a),g.focus&&b&&nbe.location.set(g,g.location)},f=function(a){nbe.state.init(g,a),g.location=null},g={id:a,state:null,dom:null,location:null,format:{},inputs:null,undo:null,trigger:null,el_editor:d,get_html:function(){return d.innerHTML},init:f,focus:!1,add_internal_oploc:null,add_external_ops:e,new_id:null,mutation:{observe:function(){},disconnect:function(){}}},b.editable&&(d.contentEditable=!0,g.new_id=nbe.lib.new_id(),g.inputs=nbe.notify.inputs(g),g.undo=nbe.editor.undo(g),g.observer=nbe.events.observer(g),g.add_internal_oploc=function(b){c.add_ops(a,b.ops),nbe.state.update(g,g.state,g.dom,b.ops),nbe.location.set(g,b.loc_after),nbe.location.format_update(g)},g.trigger=function(a,b){var c;g.focus=!0,c=nbe.triggers.trigger(g,a,b),c!==null&&c!=="break"?(g.add_internal_oploc(c),g.undo.add_oploc(c)):c===null&&(nbe.location.set(g,g.location),g.inputs.notify())},nbe.events.add_event_listeners(g)),g},nbe.editor.undo=function(a){var b,c,d,e,f,g,h,i;return b=[],c=[],d=[],e=function(a){d.push(a),g()},f=function(a){var b;b=d.indexOf(a),b!==-1&&(d=d.splice(b,1))},g=function(){var a,e;a={undo:b.length!==0,redo:c.length!==0};for(e=0;e<d.length;e++)d[e].set_value(a)},h=function(a){b.push(a),c=[],g()},i=function(d,e){var f,h;e==="undo"&&b.length!==0?(f=b.pop(),c.push(f),h=nbe.state.invert_oploc(f),a.add_internal_oploc(h),nbe.location.format_update(a)):e==="redo"&&c.length!==0&&(f=c.pop(),b.push(f),a.add_internal_oploc(f)),g()},{add_button:e,remove_button:f,add_oploc:h,trigger:i}},nbe.notify.inputs=function(a){var b,c,d,e,f;return b={},c=function(a,c){a in b&&b[a].indexOf(c)===-1?b[a].push(c):b[a]=[c]},d=function(a,c){var d,e;d=b[a],d&&(e=d.indexOf(c),e!==-1&&(b[a]=d.slice(0,e).concat(d.slice(e+1))))},f=function(c,d){var e;c==="left_margin"&&"left_margin"in b&&(d=nbe.notify.left_margin(a));for(e=0;e<(c in b?b[c].length:0);e++)b[c][e].set_value(d)},e=function(){var b;for(b in nbe.state.formats.default_values)nbe.state.formats.default_values.hasOwnProperty(b)&&f(b,b in a.format?a.format[b]:nbe.state.formats.default_values[b])},{add:c,remove:d,notify:e}},nbe.notify.left_margin=function(a,b){var c,d,e;return c="off",d="off",e=nbe.location.lines(a),e.forEach(function(a){var b;b="left_margin"in a.val?a.val.left_margin:0,d=b<nbe.state.formats.left_margin.max?"on":d,c=b>0?"on":c}),c+":"+d},nbe.paste.clipboard=function(a){var b,c,d;b=document.createElement("div"),b.contentEditable=!0,b.className="clipboard",c=document.createRange(),c.setStart(b,0),c.setEnd(b,0),d=window.getSelection(),d.removeAllRanges(),d.addRange(c),document.body.appendChild(b),b.focus(),setTimeout(function(){var c;c=nbe.paste.insertion(b),document.body.removeChild(b),a(c)},0)},nbe.paste.insertion=function(a){var b,c,d;return b={type:"line",val:{},children:[]},c={root:[b],line:b,link:null,format:{}},c=nbe.paste.traverse(c,a),d=[],Object.keys(c.root[0].val).length!==0&&d.push({type:"line",val:{},children:[]}),d=d.concat(c.root),Object.keys(c.root[c.root.length-1].val).length!==0&&d.push({type:"line",val:{},children:[]}),d},nbe.paste.traverse=function(a,b){var c,d;for(c=0;c<b.childNodes.length;c++){d=b.childNodes[c];switch(d.nodeName){case"DIV":case"div":case"P":case"p":case"H1":case"h1":case"H2":case"h2":case"H3":case"h3":case"H4":case"h4":case"H5":case"h5":case"H6":case"h6":a=nbe.paste.div(a,d);break;case"SPAN":case"span":a=nbe.paste.span(a,d);break;case"A":case"a":a=nbe.paste.link(a,d);break;case"IMG":case"img":a=nbe.paste.img(a,d);break;case"#text":case"#TEXT":a=nbe.paste.text(a,d);break;case"BR":case"br":a=nbe.paste.br(a,d);break;case"STYLE":case"style":break;default:a=nbe.paste.remaining(a,d)}}return a},nbe.paste.div=function(a,b){var c,d,e,f,g,h;c=a.format,d=nbe.lib.clone(c),e=function(a,c){var e;for(e=0;e<c.length;e++)if(b.classList.contains(c[e]))return d[a]=c[e],null},e("text_align",["center","right","justify"]),e("heading",["heading1","heading2","heading3","heading4","heading5","heading6"]),e("list",["disc","lower-alpha","lower-roman","square","upper-alpha","upper-roman","ordered"]),e("line_spacing",["line_spacing_05","line_spacing_06","line_spacing_07","line_spacing_08","line_spacing_09","line_spacing_10","line_spacing_11","line_spacing_12","line_spacing_13","line_spacing_14","line_spacing_15","line_spacing_16","line_spacing_17","line_spacing_18","line_spacing_19","line_spacing_20"]),b.style.marginLeft&&(f=Number(b.style.marginLeft.slice(0,b.style.marginLeft.length-2)),f>=0&&(d.left_margin=f)),b.style.fontSize&&(d.font_size=b.style.fontSize);switch(b.align){case"LEFT":case"left":delete d.text_align;break;case"RIGHT":case"right":d.text_align="right";break;case"CENTER":case"center":d.text_align="center";break;case"JUSTIFY":case"justify":d.text_align="justify"}switch(b.nodeName){case"H1":case"h1":d.heading="heading1";break;case"H2":case"h2":d.heading="heading2";break;case"H3":case"h3":d.heading="heading3";break;case"H4":case"h4":d.heading="heading4";break;case"H5":case"h5":d.heading="heading5";break;case"H6":case"h6":d.heading="heading6"}return g=nbe.state.copy_line_format(d,{}),a.line.children.length===0?a.line.val=g:(h={type:"line",val:g,children:[]},a.root.push(h),a.line=h),a.format=d,a=nbe.paste.traverse(a,b),a.format=c,a},nbe.paste.span=function(a,b){var c,d,e,f,g,h;return c=a.format,d=nbe.lib.clone(c),e=function(a){var c;for(c=0;c<a.length;c++)b.classList.contains(a[c])&&(d[a[c]]="on")},e(["bold","italic","underline","strikethrough"]),f=function(a){return a.slice(0,4)==="rgb("},b.style.color&&f(b.style.color)&&(d.color=b.style.color),b.style.backgroundColor&&f(b.style.backgroundColor)&&(d.background_color=b.style.backgroundColor),g=function(a){var c;for(c=0;c<a.length;c++)b.style[a[c].style]&&(d[a[c].key]=b.style[a[c].style])},g([{key:"vertical_align",style:"verticalAlign"}]),d.vertical_align?b.style.fontSize.slice(-2)==="px"&&(d.font_size=1.25*Number(b.style.fontSize.slice(0,b.style.fontSize.length-2))+"px"):g([{key:"font_size",style:"fontSize"}]),b.style.fontFamily&&(h=b.style.fontFamily.toLowerCase(),nbe.state.formats.font_family.indexOf(h)!==-1&&(d.font_family=h)),a.format=d,a=nbe.paste.traverse(a,b),a.format=c,a},nbe.paste.link=function(a,b){var c,d;return c={href:b.href},d={type:"link",val:c,children:[]},a.line.children.push(d),a.link=d,a=nbe.paste.traverse(a,b),a.link=null,a},nbe.paste.img=function(a,b){var c,d,e;return c={},d=function(a){var d;for(d=0;d<a.length;d++)b[a[d]]&&(c[a[d]]=b[a[d]])},d(["src","width","height","title"]),e={type:"img",val:c,children:[]},a.link?a.link.children.push(e):a.line.children.push(e),a},nbe.paste.text=function(a,b){var c,d;return c=nbe.state.copy_text_format(a.format,{}),c.text=b.textContent,d={type:"text",val:c,children:[]},a.link?a.link.children.push(d):a.line.children.push(d),a},nbe.paste.br=function(a,b){var c;return c={type:"line",val:{},children:[]},a.root.push(c),a.line=c,a},nbe.paste.remaining=function(a,b){var c,d;c=a.format,d=nbe.lib.clone(c);switch(b.nodeName){case"STRONG":case"strong":case"B":case"b":d.bold="on";break;case"I":case"i":d.italic="on";break;case"U":case"u":d.underline="on"}return a.format=d,a=nbe.paste.traverse(a,b),a.format=c,a},kite.browser.dom={},kite.browser.dom.eac=function(a,b,c){var d=document.createElement(a);return d.className=c,b.appendChild(d),d},kite.browser.dom.ec=function(a,b){var c=document.createElement(a);return c.className=b,c},kite.browser.dom.ea=function(a,b){var c=document.createElement(a);return b.appendChild(c),c},kite.browser.dom.input=function(a,b,c,d,e,f,g){var h,i,j,k;h=document.createElement("input"),i=["type","id","name","value","className","placeholder"];for(j=0;j<i.length;j++)k=i[j],arguments[j]&&h.setAttribute(k,arguments[j]);return g&&g.appendChild(h),h},kite.browser.dom.removeChildNodes=function(a){while(a.hasChildNodes())a.removeChild(a.firstChild)},kite.browser.dom.has_parent=function(a,b){while(a.parentNode){if(a.parentNode===b)return!0;a=a.parentNode}return!1},kite.browser.dom.text=function(a,b){return a.appendChild(document.createTextNode(b)),a},kite.browser.dom.svg=function(a,b,c,d,e,f){var g;return g=document.createElementNS("http://www.w3.org/2000/svg","svg"),g.setAttribute("version","1.2"),g.setAttribute("baseProfile","tiny"),e&&g.setAttribute("class",e),a&&g.setAttribute("x",a+"px"),b&&g.setAttribute("y",b+"px"),d&&g.setAttribute("height",d+"px"),c&&g.setAttribute("width",c+"px"),d&&c&&g.setAttribute("viewBox",(a?a+" ":"0 ")+(b?b+" ":"0 ")+" "+d+" "+c),f.appendChild(g),g},kite.browser.dom.ns=function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg",a);return b&&b.appendChild(d),c&&d.setAttribute(c[0],c[1]),d},kite.browser.ui={},kite.browser.ui.Window_core=function(){var a,b,c,d;a=this,this.close_handler=null,this.close_on="",this.is_open=!1,this.close_function=null,this.element=kite.browser.dom.ec("div","window window_light"),this.header=kite.browser.dom.ec("div","window_header header_light"),this.container=kite.browser.dom.ec("div","container"),b=new kite.browser.ui.Move(a.element,{}),this.header.addEventListener("mousedown",function(c){c.target===a.header&&b.drag_start(c,{})},!1),c=document.documentElement.clientWidth,d=document.documentElement.clientHeight,this.check_dimensions_position=function(b){if(c!==document.documentElement.clientWidth||d!==document.documentElement.clientHeight)a.position(),c=document.documentElement.clientWidth,d=document.documentElement.clientHeight},this.action=function(a,b){return!0}},kite.browser.ui.Window_core.prototype.set_content=function(a){this.container.appendChild(a)},kite.browser.ui.Window_core.prototype.set_title=function(a){this.header!==undefined&&kite.browser.dom.text(this.header,a)},kite.browser.ui.Window_core.prototype.set_close_handler=function(a){this.close_handler=a},kite.browser.ui.Window_core.prototype.open=function(a){var b=this;kite.browser.ui.set_opacity(this.element,1),this.cover&&document.body.appendChild(this.cover),document.body.appendChild(this.element),this.close_function=function(c){!kite.browser.dom.is_element_child(b.element,c.target)&&!kite.browser.dom.is_element_child(a,c.target)&&b.close()},this.close_on==="out"?this.element.addEventListener("mouseout",this.close_function,!1):this.close_on==="click"&&document.body.addEventListener("mousedown",this.close_function,!1),this.element.style.left=document.documentElement.clientWidth/2-this.element.offsetWidth/2+"px",this.position(a),this.is_open=!0,window.addEventListener("resize",this.check_dimensions_position,!1),document.body.addEventListener("orientationchange",this.check_dimensions_position,!1)},kite.browser.ui.Window_core.prototype.size=function(){this.element.style.width="auto",this.element.offsetWidth>=window.innerWidth-20?this.element.style.width=window.innerWidth-20+"px":this.element.style.width="auto",this.element.style.height="auto",this.element.offsetHeight>=document.documentElement.clientHeight-20?this.element.style.height=document.documentElement.clientHeight-20+"px":this.element.style.height="auto"},kite.browser.ui.Window_core.prototype.position=function(a){var b,c,d;this.size(),a?(b=kite.browser.ui.get_offset(a),c=b.left+a.offsetWidth/2-this.element.offsetWidth/2,c+this.element.offsetWidth>window.innerWidth?this.element.style.left=window.innerWidth-this.element.offsetWidth+"px":c<0?this.element.style.left="0px":this.element.style.left=c+"px",this.action(a,b)):(window.scrollTo(0,0),d=(document.documentElement.clientHeight-this.element.offsetHeight)/2,d<0&&(d=0),this.element.style.top=d+"px",c=(window.innerWidth-this.element.offsetWidth)/2,c<0&&(c=0),this.element.style.left=c+"px")},kite.browser.ui.Window_core.prototype.close=function(){var a=this;this.is_open&&(kite.browser.animation.Fade_out(a.element,{duration:50,fps:50,callback:function(){document.body.removeChild(a.element)}}),a.cover&&document.body.removeChild(a.cover),this.close_on==="out"?this.element.removeEventListener("mouseout",this.close_function,!1):this.close_on==="click"&&document.body.removeEventListener("mousedown",this.close_function,!1),this.close_function=null,this.is_open=!1,window.removeEventListener("resize",this.check_dimensions_position,!1),document.body.removeEventListener("orientationchange",this.check_dimensions_position,!1))},kite.browser.ui.Window_core.prototype.terminate=function(){this.close(),this.close_handler!==null&&this.close_handler()},kite.browser.ui.Window_core.prototype.insert_close_button=function(){var a=this;this.close_button=kite.browser.dom.eac("img",kite.browser.dom.eac("div",this.header,"close_div"),"close_button"),this.close_button.src="/public/inlund/img/close.png",this.close_button.addEventListener("click",function(b){a.terminate()},!1)},kite.browser.ui.Window_core.prototype.insert_footer=function(a){var b,c,d;b=this,this.footer=kite.browser.dom.eac("div",a,"window_footer_light"),c=kite.browser.dom.eac("img",b.footer,"window_resize"),c.src="/public/inlund/img/resize.png",d=kite.browser.ui.Resize(b.container,{}),c.addEventListener("mousedown",function(a){d.drag_start(a,{})},!1)},kite.browser.ui.Window=function(){var a=new kite.browser.ui.Window_core;return a.element.appendChild(a.container),a},kite.browser.ui.Dialog=function(){var a=new kite.browser.ui.Window_core;return a.container.className="container_dark",a.cover=kite.browser.dom.ec("div","dialog_cover"),a.cover.addEventListener("click",function(b){kite.browser.animation.shake(a.element,null)},!1),a.element.appendChild(a.container),a},kite.browser.ui.confirm=function(a,b,c,d){var e,f,g,h,i,j;e=new kite.browser.ui.Dialog,e.set_title(a),f=kite.browser.dom.ec("div","confirm_content"),f.textContent=b,g=kite.browser.dom.eac("div",f,"overflow_hidden"),g.style.marginTop="10px";for(h=0,i=c.length;h<i;h++)j=kite.browser.dom.eac("button",g,"float_left"),j.textContent=c[h],j.id=c[h];e.set_content(f),g.addEventListener("click",function(a){a.target.id&&(d&&d(a.target.id),e.close())},!1),e.open()},kite.browser.ui.Confirm=function(a,b,c,d){var e,f,g,h,i,j;e=new kite.browser.ui.Dialog,e.set_title(a),f=kite.browser.dom.ec("div","confirm_content"),f.textContent=b,g=kite.browser.dom.eac("div",f,"overflow_hidden"),g.style.marginTop="10px";for(h=0,i=c.length;h<i;h++)j=kite.browser.dom.eac("button",g,"float_left"),j.textContent=c[h],j.id=c[h];return e.set_content(f),g.addEventListener("click",function(a){a.target.id&&(d&&d(a.target.id),e.close())},!1),e},kite.browser.ui.Pop_up=function(){var a,b,c,d;return a=new kite.browser.ui.Window_core,a.close_on="click",a.element.style.backgroundImage="none",a.container.className="container_radius_bottom",a.element.appendChild(a.header),a.element.appendChild(a.container),a.insert_close_button(),b=kite.browser.dom.eac("div",a.element,"pop_up_arrow_space"),c=kite.browser.dom.eac("div",b,"pop_up_arrow_container"),d=kite.browser.dom.ea("img",c),d.src="/public/inlund/img/pop_up_arrow.png",a.action=function(b,c){a.element.style.top=c.top+"px",kite.browser.animation.Slide_up(a.element,{duration:100,padding:1,callback:function(){a.size()}})},a},kite.browser.ui.Drop_down=function(){var a=new kite.browser.ui.Window_core;return a.close_on="click",a.container.className="container_radius_no_padding",a.element.appendChild(a.container),a.action=function(b,c){a.element.style.top=c.top+b.offsetHeight+"px",kite.browser.animation.Slide_down(a.element,{duration:100,padding:1,callback:function(){a.size()}})},a},kite.browser.ui.get_offset=function(a){var b,c;b=a.offsetLeft,c=a.offsetTop,a=a.offsetParent;while(a)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;return{left:b,top:c}},kite.browser.ui.set_opacity=function(a,b){a.style.opacity=b,a.style.filter="alpha(opacity = "+b*100+")"},kite.browser.ui.cursor_position=function(a){return{x:a.clientX+window.scrollX,y:a.clientY+window.scrollY}},kite.browser.ui.Move_resize_core=function(a,b){this.options={},this.drag={element:a,container:a.parentNode,direction:null,padding:0,step_size:1},this.change_options(b)},kite.browser.ui.Move_resize_core.prototype.drag_start=function(a,b){var c,d,e;a.preventDefault(),c=this,c.drag_callback=b.drag_callback?b.drag_callback:function(){},d=kite.browser.ui.cursor_position(a),this.drag.antagonist&&(this.drag.start_width_antagonist=this.drag.antagonist.offsetWidth,this.drag.start_height_antagonist=this.drag.antagonist.offsetHeight),this.drag.start_width=this.drag.element.offsetWidth,this.drag.start_height=this.drag.element.offsetHeight,this.drag.start_left=this.drag.element.offsetLeft,this.drag.start_top=this.drag.element.offsetTop,this.drag.max_offset_left=this.options.max_offset_left-this.drag.padding||-5e3,this.drag.max_offset_right=this.options.max_offset_right-this.drag.padding||(this.drag.container?this.drag.container.offsetWidth-this.drag.padding:5e3),this.drag.max_offset_top=this.options.max_offset_top-this.drag.padding||0,this.drag.max_offset_bottom=this.options.max_offset_bottom-this.drag.padding||(this.drag.container?this.drag.container.offsetHeight-this.drag.padding:5e3),this.drag.cursor_start_x=d.x,this.drag.cursor_start_y=d.y,e=function(a){document.removeEventListener("mousemove",c.go,!1),document.removeEventListener("mouseup",e,!1),b.stop_callback&&b.stop_callback()},document.addEventListener("mousemove",this.go,!1),document.addEventListener("mouseup",e,!1)},kite.browser.ui.Move_resize_core.prototype.change_options=function(a){var b;for(b in a)a.hasOwnProperty(b)&&(this.options[b]=a[b],this.drag[b]=a[b])},kite.browser.ui.Move=function(a,b){var c;return c=new kite.browser.ui.Move_resize_core(a,b),c.go=function(a){var b,d;b=kite.browser.ui.cursor_position(a),a.preventDefault();if(c.drag.direction!=="vertical"){d=c.drag.start_left+kite.browser.ui.cursor_position(a).x-c.drag.cursor_start_x;if(d<c.drag.max_offset_left)c.drag.element.style.left=c.drag.max_offset_left+"px";else if(d<c.drag.max_offset_right)c.drag.element.style.left=d+"px";else if(d>c.drag.max_offset_right||b.x>0)c.drag.element.style.left=c.drag.max_offset_right+"px"}c.drag.direction!=="horizontal"&&(d=c.drag.start_top+kite.browser.ui.cursor_position(a).y-c.drag.cursor_start_y,d<c.drag.max_offset_top?c.drag.element.style.top=c.drag.max_offset_top+"px":d<c.drag.max_offset_bottom?c.drag.element.style.top=d+"px":d>c.drag.max_offset_bottom&&(c.drag.element.style.top=c.drag.max_offset_bottom+"px")),c.drag.move_callback&&c.drag.move_callback(a)},c},kite.browser.ui.Resize=function(a,b){var c;return c=new kite.browser.ui.Move_resize_core(a,b),c.go=function(a){var b,d,e,f;a.preventDefault(),b=kite.browser.ui.cursor_position(a),d=1,e=null,f=null,c.drag.reverse&&(d=-1),c.drag.direction!=="vertical"&&b.x+15<=document.documentElement.clientWidth&&b.x>0&&(e=c.drag.start_width+(b.x-c.drag.cursor_start_x)*d,c.drag.element.style.width=e+"px",c.drag.antagonist&&(c.drag.antagonist.style.width=c.drag.start_width_antagonist+(b.x-c.drag.cursor_start_x)*-1*d+"px")),c.drag.direction!=="horizontal"&&b.y+15<=document.documentElement.clientHeight&&b.y>0&&(f=c.drag.start_height+(b.y-c.drag.cursor_start_y)*d,c.drag.element.style.height=f+"px",c.drag.antagonist&&(c.drag.antagonist.style.height=c.drag.start_height+(b.y-c.drag.cursor_start_y)*-1*d+"px")),c.drag_callback&&c.drag_callback(a,e,f)},c},"use strict",kite.browser.animation={},kite.browser.animation.Core=function(a){var b;this.options={duration:200,fps:100,from:0,to:200,padding:0};for(b in a)a.hasOwnProperty(b)&&(this.options[b]=a[b]);this.options.element2&&(this.options.element2.start_width=this.options.element2.start_width||this.options.element2.element.offsetWidth,this.options.element2.padding=this.options.element2.padding||0),this.start_on=0,this.finish_on=this.start_on-this.options.duration,this.from_to_delta=this.options.to-this.options.from,this.total_time=this.finish_on-this.start_on,this.total_frames=this.options.fps*(this.options.duration/1e3)},kite.browser.animation.Core.prototype.render=function(){var a,b,c;a=this,b=1,c=function(){a.action(b),b<a.total_frames?(b+=1,setTimeout(c,1e3/a.options.fps)):(a.end(),a.options.callback&&a.options.callback())},setTimeout(c,1e3/this.options.fps)},kite.browser.animation.Hide_up=function(a,b){var c=new kite.browser.animation.Core(b);c.init=function(){c.target_height=c.options.target_height||a.offsetHeight,c.target_top=c.options.target_top||a.offsetTop-c.target_height,c.start_top=a.offsetTop},c.end=function(){a.style.top=c.target_top+"px"},c.action=function(b){var d=Math.round(b/c.total_frames*c.target_height);a.style.top=c.start_top-d+"px"},c.init(),c.render()},kite.browser.animation.Slide_up=function(a,b){var c=new kite.browser.animation.Core(b);c.init=function(){c.target_height=c.options.target_height||a.offsetHeight,c.target_top=c.options.target_top||a.offsetTop-c.target_height,c.start_top=a.offsetTop,a.style.height="0px",a.style.overflow="hidden"},c.end=function(){a.style.top=c.target_top+"px",a.style.overflow="visible",a.style.height="auto"},c.action=function(b){var d=Math.round(b/c.total_frames*c.target_height);a.offsetHeight<c.target_height&&(a.style.height=d-c.options.padding*2+"px"),a.style.top=c.start_top-d+"px"},c.init(),c.render()},kite.browser.animation.Slide_down=function(a,b){var c=new kite.browser.animation.Core(b);c.init=function(){c.target_height=c.options.target_height||a.offsetHeight,c.child=a.firstChild,c.target_top=0,c.start_child_top=-1*c.target_height,c.child.style.position="relative",c.child.style.top=c.start_child_top+"px",a.style.height="0px",a.style.overflow="hidden"},c.top=function(a){window.innerHeight<a.offsetTop+a.offsetHeight&&(a.style.top=window.innerHeight-a.offsetHeight+"px")},c.end=function(){c.child.style.top=c.target_top+"px",a.style.overflow="visible",a.style.height="auto",c.top(a)},c.action=function(b){var d,e;d=Math.round(b/c.total_frames*c.target_height),a.offsetHeight<c.target_height&&(e=d-c.options.padding*2,a.style.height=e+"px",c.top(a),c.child.style.top=c.start_child_top+d-c.options.padding+"px")},c.init(),c.render()},kite.browser.animation.Slide_in_right=function(a,b){var c=new kite.browser.animation.Core(b);c.init=function(){c.start_width=c.options.start_width||a.offsetWidth,c.target_width=c.options.target_width||0},c.end=function(){a.style.width=c.target_width+"px"},c.action=function(b){var d=Math.round(b/c.total_frames*c.start_width);a.offsetWidth>c.target_width&&(a.style.width=c.start_width-d-c.options.padding*2+"px",c.options.element2&&(c.options.element2.element.style.width=c.options.element2.start_width+d-c.options.element2.padding*2+"px"))},c.init(),c.render()},kite.browser.animation.Slide_out_left=function(a,b){var c=new kite.browser.animation.Core(b);c.init=function(){c.start_width=c.options.start_width||a.offsetWidth,c.target_width=c.options.target_width||0},c.end=function(){a.style.width=c.target_width+"px"},c.action=function(b){var d=Math.round(b/c.total_frames*c.target_width);a.offsetWidth<c.target_width&&(a.style.width=d-c.options.padding*2+"px",c.options.element2&&(c.options.element2.element.style.width=c.options.element2.start_width-d-c.options.element2.padding*2+"px"))},c.init(),c.render()},kite.browser.animation.Resize=function(a,b){var c=new kite.browser.animation.Core(b);c.init=function(){c.target_height=c.options.target_height>=0?c.options.target_height:a.offsetHeight,c.target_width=c.options.target_width>=0?c.options.target_width:a.offsetWidth,c.start_height=c.options.start_height>=0?c.options.start_height:a.offsetHeight,c.start_width=c.options.start_width>=0?c.options.start_width:a.offsetWidth},c.end=function(){b.target_height>=0&&(a.style.height=c.target_height+"px"),b.target_width>=0&&(a.style.width=c.target_width+"px")},c.action=function(d){var e=d/c.total_frames;b.target_height>=0&&c.start_height!==c.target_height&&(a.style.height=Math.round(c.start_height+e*(c.target_height-c.start_height))+"px"),b.target_width>=0&&c.start_width!==c.target_width&&(a.style.width=Math.round(c.start_width+e*(c.target_width-c.start_width))+"px")},c.init(),c.render()},kite.browser.animation.Fade_out=function(a,b){var c=new kite.browser.animation.Core(b);c.init=function(){c.start=1,c.target=0},c.end=function(){a.style.opacity=c.target},c.action=function(b){a.style.opacity=c.start-b/c.total_frames},c.init(),c.render()},kite.browser.animation.Fade_in=function(a,b){var c=new kite.browser.animation.Core(b);c.init=function(){c.start=0,c.target=1,a.style.display="block"},c.end=function(){a.style.opacity=c.target},c.action=function(b){a.style.opacity=b/c.total_frames*c.target},c.init(),c.render()},kite.browser.animation.Highlight=function(a,b){var c,d;c=new kite.browser.animation.Core(b),c.init=function(){c.start_rgb=b.start_rgb,c.target_rgb={r:b.target_rgb.r-b.start_rgb.r,g:b.target_rgb.g-b.start_rgb.g,b:b.target_rgb.b-b.start_rgb.b}},c.end=function(){a.style.backgroundColor=""},c.action=function(b){d=b/c.total_frames,a.style.backgroundColor="rgb("+Math.ceil(d*c.target_rgb.r+c.start_rgb.r)+","+Math.ceil(d*c.target_rgb.g+c.start_rgb.g)+","+Math.ceil(d*c.target_rgb.b+c.start_rgb.b)+")"},c.init(),c.render()},kite.browser.animation.Scroll=function(a,b){var c=new kite.browser.animation.Core(b);c.init=function(){c.start=a.scrollLeft},c.end=function(){a.scrollLeft=b.to},c.action=function(d){a.scrollLeft=c.start+(b.to-c.start)/c.total_frames*d},c.init(),c.render()},kite.browser.animation.shake=function(a,b){var c,d,e,f,g;c=a.offsetLeft,d=5,e=0,f=1,g=setInterval(function(){a.style.left=a.offsetLeft+d*f+"px",e+=d*f;if(e>=20||e<=-20)f*=-1},10),setTimeout(function(){clearInterval(g),a.style.left=c+"px",b&&b()},400)},nbe.browser.icon.network=function(a){var b,c,d,e;return b="You offline",c=kite.browser.dom.ea("div",a),c.title=b,d=kite.browser.dom.svg(-8,-8,48,48,"circle_button",c),e=kite.browser.dom.ns("polygon",d,["points","32,0 8,16 14,20 0,32 24,20 18,16"]),{on:function(){e.setAttribute("fill","lightgreen"),c.title="You are online"},off:function(){e.setAttribute("fill","red"),c.title=b}}},nbe.browser.icon.saved=function(a){var b,c,d,e,f;return b="The document is saved",c=kite.browser.dom.ea("div",a),c.title=b,d=kite.browser.dom.svg(-8,-8,48,48,"circle_button",c),e=kite.browser.dom.ns("path",d,["d","M24,4c-0.375,0-0.738,0.062-1.102,0.109C21.504,1.648,18.926,0,16,0c-2.988,0-5.568,1.664-6.941,4.102C8.707,4.055,8.357,4,8,4c-4.412,0-8,3.586-8,8s3.588,8,8,8h16c4.414,0,8-3.586,8-8S28.414,4,24,4z M24,16H8c-2.205,0-4-1.797-4-4c0-2.195,1.943-3.883,4.004-3.945C8.012,9,8.176,9.922,8.504,10.797l3.746-1.398C12.084,8.953,12,8.484,12,8c0-2.203,1.795-4,4-4c1.295,0,2.463,0.641,3.201,1.641C17.27,7.102,16,9.395,16,12h4c0-2.203,1.797-4,4-4s4,1.797,4,4S26.203,16,24,16z"]),f=kite.browser.dom.ns("polygon",d,["points","18.002,26 22,26 16.004,20 10.002,26 14.002,26 14.002,32 18.002,32"]),{on:function(){e.setAttribute("fill","lightgreen"),f.setAttribute("fill","lightgreen"),c.title=b},off:function(){e.setAttribute("fill","red"),f.setAttribute("fill","red"),c.title="The document is not saved"}}},nbe.browser.icon.exporticon=function(a){var b,c,d,e;return b=kite.browser.dom.ea("div",a),b.title="Export",c=kite.browser.dom.svg(-16,-11,56,56,"circle_button",b),d=kite.browser.dom.ns("rect",c,["y","27.43"]),d.style.fill="#FFFFFF",d.setAttribute("width",24),d.setAttribute("height",4.57),e=kite.browser.dom.ns("polygon",c,["points","16,18.285 16,0 8,0 8,18.285 4,18.285 12.012,27.43 20,18.285"]),e.style.fill="#FFFFFF",b},nbe.inputs.color_menu=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;f=!1,g=document.body,h=kite.browser.dom.ec("div","wu-menu wu-color_menu"),h.addEventListener("click",function(a){var b;b=a.target.getAttribute("data-color"),b&&w(b)},!1),i=e,j={},k=function(a,b){var c;return c=kite.browser.dom.eac("div",b,"wu-color_swatch"),c.style.backgroundColor=a,c.setAttribute("data-color",a),c},l=kite.browser.dom.eac("div",h,"wu-color_default"),m=function(a){var b;p.value!==""&&q.value!==""&&r.value!==""?(b="rgb("+p.value+", "+q.value+", "+r.value+")",o.style.backgroundColor=b,w(b)):w(e)},n=kite.browser.dom.eac("div",h,"wu-color_custom"),o=kite.browser.dom.eac("div",n,"wu-color_swatch"),o.addEventListener("click",function(a){m(a)},!1),kite.browser.dom.ea("span",n).textContent="R:",p=kite.browser.dom.ea("input",n),p.addEventListener("keyup",m,!1),kite.browser.dom.ea("span",n).textContent="G:",q=kite.browser.dom.ea("input",n),q.addEventListener("keyup",m,!1),kite.browser.dom.ea("span",n).textContent="B:",r=kite.browser.dom.ea("input",n),r.addEventListener("keyup",m,!1),j[b]=k(b,l),s=kite.browser.dom.ea("span",l),s.textContent=c,s.setAttribute("data-color",b);for(t=0;t<d.length;t++)j[d[t]]=k(d[t],h);return u=function(){f=!1,g.removeChild(h),document.body.removeEventListener("click",v,!1),a(i)},v=function(a){a.target!==p&&a.target!==q&&a.target!==r&&u()},w=function(a){j[i]&&j[i].classList.remove("wu-selected"),o.classList.remove("wu-selected"),o.style.backgroundColor="transparent",j[a]?j[a].classList.add("wu-selected"):(o.classList.add("wu-selected"),o.style.backgroundColor=a),i=a},{display:function(a,b,c){var d,e;f=!0,g.appendChild(h),e=kite.browser.ui.get_offset(b),h.style.left=e.left-h.offsetWidth/2+b.offsetWidth/2+"px",h.style.top=e.top+b.offsetHeight+"px",document.body.addEventListener("click",v,!1),w(c),j[c]?p.value!==""&&q.value!==""&&r.value!==""&&(o.style.backgroundColor="rgb("+p.value+", "+q.value+", "+r.value+")"):(d=c.match(/^rgb\((\d+), (\d+), (\d+)\)$/),p.value=d[1],q.value=d[2],r.value=d[3])},remove:u,is_open:function(){return f}}},nbe.inputs.input=function(a,b){var c,d,e;return c=b?[b]:[],d=function(a){var b,d;d=!0;for(b=0;b<c.length;b++)c[b]===a&&(d=!1);d&&c.push(a)},e=function(a){var b;for(b=0;b<c.length;b++)c[b]===a&&c.splice(b,1)},{editors:c,add_trigger:d,remove_trigger:e,trigger:function(b){var d;for(d=0;d<c.length;d++)c[d](a,b)},get_triggers:function(){return c}}},nbe.inputs.button=function(a,b,c,d,e){var f,g,h,i;return f=nbe.inputs.input(a,d),g=null,h=kite.browser.dom.eac("button",c,"wu-icon wu-icon-"+a+" off"),h.title=b,i=function(b){g!==b&&(g=b,h.className="wu-icon wu-icon-"+a+" "+g)},i(e),h.addEventListener("click",function(){f.trigger(g==="off"?"on":"off")}),f.element=h,f.set_value=i,f},nbe.inputs.bold=function(a,b,c,d){var e;return e=nbe.inputs.button("bold",b,c,a,d),e.element.textContent="B",e},nbe.inputs.italic=function(a,b,c,d){var e;return e=nbe.inputs.button("italic",b,c,a,d),e.element.textContent="I",e},nbe.inputs.underline=function(a,b,c,d){var e;return e=nbe.inputs.button("underline",b,c,a,d),e.element.textContent="U",e},nbe.inputs.strikethrough=function(a,b,c,d){var e;return e=nbe.inputs.button("strikethrough",b,c,a,d),e.element.textContent="S",e},nbe.inputs.color=function(a,b,c,d){var e,f,g,h,i;return e=nbe.inputs.input("color",a),f=null,g=kite.browser.dom.eac("button",c,"wu-icon off"),g.title=b,g.textContent="A",h=nbe.inputs.color_menu(function(a){e.trigger(a)},"rgb(0, 0, 0)","Black",["rgb(255, 200, 200)","rgb(255, 200, 75)","rgb(255, 255, 200)","rgb(200, 255, 0)","rgb(200, 255, 200)","rgb(150, 255, 225)","rgb(200, 255, 255)","rgb(135, 240, 255)","rgb(100, 175, 255)","rgb(235, 120, 255)","rgb(255, 100, 200)","rgb(224,224,224)","rgb(255, 150, 150)","rgb(255, 175, 50)","rgb(255, 255, 150)","rgb(175, 255, 0)","rgb(150, 255, 150)","rgb(100, 255, 200)","rgb(150, 255, 255)","rgb(80, 235, 255)","rgb(0, 150, 255)","rgb(200, 80, 255)","rgb(237, 0, 175)","rgb(192,192,192)","rgb(255, 100, 100)","rgb(255, 150, 25)","rgb(255, 255, 100)","rgb(150, 255, 0)","rgb(100, 255, 100)","rgb(50, 255, 175)","rgb(100, 255, 255)","rgb(50, 220, 255)","rgb(0, 100, 255)","rgb(175, 40, 255)","rgb(218, 0, 150)","rgb(160,160,160)","rgb(255, 0, 0)","rgb(255, 125, 0)","rgb(255, 255, 0)","rgb(125, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 150)","rgb(0, 255, 255)","rgb(0, 200, 255)","rgb(0, 0, 255)","rgb(150, 0, 255)","rgb(200, 0, 125)","rgb(128,128,128)","rgb(200 ,0, 0)","rgb(200, 100, 0)","rgb(200, 200, 0)","rgb(100, 200, 0)","rgb(0, 200, 0)","rgb(0, 200, 125)","rgb(0, 200, 200)","rgb(0, 170, 225)","rgb(0, 0, 200)","rgb(125, 0, 200)","rgb(170, 0, 105)","rgb(96,96,96)","rgb(150, 0, 0)","rgb(150, 75, 0)","rgb(150, 150, 0)","rgb(75, 150, 0)","rgb(0, 150, 0)","rgb(0, 150, 100)","rgb(0, 150, 150)","rgb(0, 140, 195)","rgb(0, 0, 150)","rgb(100, 0, 150)","rgb(140, 0, 85)","rgb(64,64,64)","rgb(100, 0, 0)","rgb(100, 50, 0)","rgb(100, 100, 0)","rgb(50, 100, 0)","rgb(0, 100, 0)","rgb(0, 100, 75)","rgb(0, 100, 100)","rgb(0, 110, 165)","rgb(0, 0, 100)","rgb(75, 0, 100)","rgb(110, 0, 65)","rgb(32,32,32)"],d),i=function(a){f!==a&&(f=a,g.style.color=f)},i(d),g.addEventListener("click",function(a){a.stopPropagation(),h.is_open()?h.remove():h.display(c,g,f)},!1),e.element=g,e.set_value=i,e},nbe.inputs.background_color=function(a,b,c,d){var e,f,g,h,i,j;return e=nbe.inputs.input("background_color",a),f=null,g=kite.browser.dom.eac("button",c,"wu-icon wu-icon-background_color off"),g.title=b,h=kite.browser.dom.ea("div",g),h.textContent="A",i=nbe.inputs.color_menu(function(a){e.trigger(a)},"transparent","None",["rgb(255, 200, 200)","rgb(255, 200, 75)","rgb(255, 255, 200)","rgb(200, 255, 0)","rgb(200, 255, 200)","rgb(150, 255, 225)","rgb(200, 255, 255)","rgb(135, 240, 255)","rgb(100, 175, 255)","rgb(235, 120, 255)","rgb(255, 100, 200)","rgb(224,224,224)","rgb(255, 150, 150)","rgb(255, 175, 50)","rgb(255, 255, 150)","rgb(175, 255, 0)","rgb(150, 255, 150)","rgb(100, 255, 200)","rgb(150, 255, 255)","rgb(80, 235, 255)","rgb(0, 150, 255)","rgb(200, 80, 255)","rgb(237, 0, 175)","rgb(192,192,192)","rgb(255, 100, 100)","rgb(255, 150, 25)","rgb(255, 255, 100)","rgb(150, 255, 0)","rgb(100, 255, 100)","rgb(50, 255, 175)","rgb(100, 255, 255)","rgb(50, 220, 255)","rgb(0, 100, 255)","rgb(175, 40, 255)","rgb(218, 0, 150)","rgb(160,160,160)","rgb(255, 0, 0)","rgb(255, 125, 0)","rgb(255, 255, 0)","rgb(125, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 150)","rgb(0, 255, 255)","rgb(0, 200, 255)","rgb(0, 0, 255)","rgb(150, 0, 255)","rgb(200, 0, 125)","rgb(128,128,128)","rgb(200 ,0, 0)","rgb(200, 100, 0)","rgb(200, 200, 0)","rgb(100, 200, 0)","rgb(0, 200, 0)","rgb(0, 200, 125)","rgb(0, 200, 200)","rgb(0, 170, 225)","rgb(0, 0, 200)","rgb(125, 0, 200)","rgb(170, 0, 105)","rgb(96,96,96)","rgb(150, 0, 0)","rgb(150, 75, 0)","rgb(150, 150, 0)","rgb(75, 150, 0)","rgb(0, 150, 0)","rgb(0, 150, 100)","rgb(0, 150, 150)","rgb(0, 140, 195)","rgb(0, 0, 150)","rgb(100, 0, 150)","rgb(140, 0, 85)","rgb(64,64,64)","rgb(100, 0, 0)","rgb(100, 50, 0)","rgb(100, 100, 0)","rgb(50, 100, 0)","rgb(0, 100, 0)","rgb(0, 100, 75)","rgb(0, 100, 100)","rgb(0, 110, 165)","rgb(0, 0, 100)","rgb(75, 0, 100)","rgb(110, 0, 65)","rgb(32,32,32)"],d),j=function(a){f!==a&&(f=a,h.style.backgroundColor=f)},j(d),g.addEventListener("click",function(a){a.stopPropagation(),i.is_open()?i.remove():i.display(c,g,f)},!1),e.element=g,e.set_value=j,e},nbe.inputs.vertical_align=function(a,b,c){var d,e,f,g,h;return d=kite.browser.dom.ea("div",b),e=nbe.inputs.input("vertical_align",a),f=function(a,b){b==="on"?e.trigger(a):e.trigger("baseline")},g=nbe.inputs.button("super","Superscript",d,f,"off"),g.element.innerHTML="A<span>2</span>",h=nbe.inputs.button("sub","Subscript",d,f,"off"),h.element.innerHTML="A<span>2</span>",e.element=d,e.set_value=function(a){a==="super"?(g.set_value("on"),h.set_value("off")):a==="sub"?(h.set_value("on"),g.set_value("off")):(g.set_value("off"),h.set_value("off"))},e.set_value(c),e},nbe.inputs.left_margin=function(a,b,c){var d,e,f,g,h;return d=["off","on"],e=kite.browser.dom.ea("div",b),f=nbe.inputs.input("left_margin",a),g=nbe.inputs.button("decrease_indent","Decrease indentation",b,function(){d[0]==="on"&&f.trigger("decrement")},"off"),g.element.textContent="<",h=nbe.inputs.button("increase_indent","Increase indentation",b,function(){d[1]==="on"&&f.trigger("increment")},"off"),h.element.textContent=">",f.element=e,f.set_value=function(a){d=a.split(":"),g.set_value(d[0]),h.set_value(d[1])},f.set_value(c),f},nbe.inputs.undo=function(a,b){var c,d,e,f;return c=kite.browser.dom.ea("div",b),d=nbe.inputs.input("undo",a),e=nbe.inputs.button("undo","Undo",c,function(){d.trigger("undo")},"off"),kite.browser.dom.ea("img",e.element).src="/img/undo.svg",f=nbe.inputs.button("redo","Redo",c,function(){d.trigger("redo")},"off"),kite.browser.dom.ea("img",f.element).src="/img/redo.svg",d.element=c,d.set_value=function(a){e.set_value(a.undo?"on":"off"),f.set_value(a.redo?"on":"off")},d},nbe.inputs.drop_down=function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s;i=nbe.inputs.input(a,f),j=null,k=document.body,l=kite.browser.dom.eac("div",e,"wu-icon wu-drop-down wu-icon-"+a),l.title=b,l.addEventListener("click",function(a){var b;!p.parentNode&&a.target!==m&&(b=kite.browser.ui.get_offset(l),p.style.left=b.left+1+"px",p.style.top=b.top+l.offsetHeight+"px",k.appendChild(p),o=!1,setTimeout(function(){o=!0},0))},!0),m=document.createElement("input"),h&&(l.appendChild(m),m.type="text",n=function(a){var b=m.value.replace(/\s/g,"");isNaN(b)?(alert("Please specify a number."),s(j)):(s(b+"px"),i.trigger(j))},m.addEventListener("blur",n,!1),m.addEventListener("keyup",function(a){a.keyCode===13&&n(a)},!1)),document.body.addEventListener("click",function(a){p.parentNode&&o&&k.removeChild(p)},!1),p=kite.browser.dom.ec("div","wu-menu drop_down_menu"),p.addEventListener("click",function(a){var b;b=a.target.getAttribute("data-option")?a.target.getAttribute("data-option"):a.target.parentNode.getAttribute("data-option"),i.trigger(b),p.parentNode&&k.removeChild(p)},!1),q={};for(r in c)c.hasOwnProperty(r)&&(q[r]=kite.browser.dom.eac("div",p,"wu-menu-row"),q[r].setAttribute("data-option",r),q[r].innerHTML=c[r]);return s=function(a){j&&j in q&&(q[j].className="wu-menu-row"),j=a,j in q&&(q[j].className="wu-menu-row wu-selected"),h?m.value=j.replace("px",""):l.innerHTML=d[j]?d[j]:c[j]?c[j].replace(" (default)",""):j},s(g),i.element=l,i.set_value=s,i},nbe.inputs.heading=function(a,b,c,d,e,f){var g;return g=nbe.inputs.drop_down("heading",b,c,d,e,a,f,!1),g},nbe.inputs.font_family=function(a,b,c,d,e){var f;return f=nbe.inputs.drop_down("font_family",b,c,{},d,a,e,!1),f},nbe.inputs.font_size=function(a,b,c,d,e){var f;return f=nbe.inputs.drop_down("font_size",b,c,{},d,a,e,!0),f},nbe.inputs.text_align=function(a,b,c,d,e){var f;return f=nbe.inputs.drop_down("text_align",b,c,{},d,a,e,!1),f},nbe.inputs.line_spacing=function(a,b,c,d,e){var f;return f=nbe.inputs.drop_down("line_spacing",b,c,{},d,a,e,!1),f},nbe.inputs.list=function(a,b,c,d,e){var f;return f=nbe.inputs.drop_down("list",b,c,{},d,a,e,!1),f},nbe.inputs.special_characters=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;d=nbe.inputs.input("text",a),e=kite.browser.dom.eac("button",c,"wu-icon wu-icon-special_characters off"),e.title=b,f=new kite.browser.ui.Window,f.set_title("Special Characters"),e.addEventListener("click",function(a){a.stopPropagation(),f.is_open?f.close():f.open()},!1),g=kite.browser.dom.ec("div","wu-special_characters"),kite.browser.dom.ea("div",g).textContent="Please choose character sets: ",h=kite.browser.dom.ea("select",g),i=[],j=kite.browser.dom.ea("div",g),k=function(a,b){var c,d;c=[];for(d=a;d<=b;d++)c.push(String.fromCharCode(d));return c},l=[{name:"latin extended",characters:k(192,687)},{name:"greek and coptic",characters:k(880,1023)},{name:"mathematical operators",characters:k(8704,8959)},{name:"arrows",characters:k(8592,8703)},{name:"currency",characters:k(8352,8399)}];for(m=0;m<l.length;m+=1){i[m]=kite.browser.dom.ec("div","wu-character_set"),n=kite.browser.dom.ea("option",h),n.textContent=l[m].name,n.value=m;for(o=0;o<l[m].characters.length;o+=1)p=kite.browser.dom.ea("div",i[m]),p.textContent=l[m].characters[o],o%11===0&&(p.style.clear="left")}return j.appendChild(i[0]),h.addEventListener("change",function(a){j.removeChild(j.firstChild),j.appendChild(i[a.target.value])},!1),kite.browser.dom.ea("div",g).textContent="Characters to insert:",q=kite.browser.dom.ea("input",g),r=kite.browser.dom.eac("div",g,"wu-special_character_buttons"),s=kite.browser.dom.eac("button",r,"button"),s.textContent="Insert characters",t=kite.browser.dom.eac("button",r,"button"),t.textContent="Cancel",f.set_content(g),g.addEventListener("click",function(a){s===a.target?(d.trigger(q.value),q.value="",f.close()):t===a.target?f.close():a.target.parentNode.className==="wu-character_set"&&(q.value+=a.target.textContent)},!1),d.element=e,d},nbe.inputs.insert_link=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;return d=nbe.inputs.input("link",a),e=kite.browser.dom.eac("button",c,"wu-icon wu-icon-insert_link off"),e.title=b,f=new kite.browser.ui.Window,f.set_title("Insert link"),e.addEventListener("click",function(a){a.stopPropagation(),f.is_open?f.close():(g=!1,g?i.parentNode&&h.removeChild(i):h.insertBefore(i,l),j.textContent="",m.textContent="",f.open())},!1),h=kite.browser.dom.ec("div","wu-special_characters"),i=document.createElement("div"),kite.browser.dom.ea("span",i).textContent="Link text: ",j=kite.browser.dom.eac("span",i,"message_failure"),kite.browser.dom.ea("br",i),k=kite.browser.dom.ea("input",i),k.type="text",l=kite.browser.dom.ea("div",h),kite.browser.dom.ea("span",l).textContent="URL: ",m=kite.browser.dom.eac("span",l,"message_failure"),kite.browser.dom.ea("br",l),n=kite.browser.dom.ea("input",l),n.type="text",n.value="http://",o=kite.browser.dom.eac("div",h,"wu-special_character_buttons"),p=kite.browser.dom.eac("button",o,"button"),p.textContent="Insert link",q=kite.browser.dom.eac("button",o,"button"),q.textContent="Cancel",f.set_content(h),h.addEventListener("click",function(a){var b;p===a.target?k.value===""?j.textContent=" Please specify a link text":n.value===""?m.textContent=" Please specify a url":(b={href:n.value},g||(b.insertion=[{type:"text",val:{text:k.value},children:[]}]),d.trigger(b),k.value="",n.value="http://",f.close()):q===a.target&&f.close()},!1),d.element=e,d},nbe.inputs.edit_link=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p;return e=nbe.inputs.input("link",a),f=kite.browser.dom.eac("button",c,"wu-icon wu-icon-edit_link off"),f.title=b,kite.browser.dom.ea("img",f).src="/img/pen_alt2.svg",kite.browser.dom.ea("img",f).src="/img/link.svg",g=null,h=null,i=function(a){g=a,g?(h=g.id,m.value=g.href,f.className="wu-icon wu-icon-edit_link on"):(m.value="",f.className="wu-icon wu-icon-edit_link off")},j=new kite.browser.ui.Window,j.set_title("Edit link"),f.addEventListener("click",function(a){a.stopPropagation(),j.is_open?j.close():g&&j.open()},!1),k=kite.browser.dom.ec("div","wu-special_characters"),l=kite.browser.dom.ea("div",k),kite.browser.dom.ea("div",l).textContent="URL: ",m=kite.browser.dom.ea("input",l),m.type="text",n=kite.browser.dom.eac("div",k,"wu-special_character_buttons"),o=kite.browser.dom.eac("button",n,"button"),o.textContent="OK",p=kite.browser.dom.eac("button",n,"button"),p.textContent="Cancel",j.set_content(k),k.addEventListener("click",function(a){o===a.target?(e.trigger({id:h,href:m.value}),j.close()):p===a.target&&j.close()},!1),i(d),e.set_value=i,e.element=f,e},nbe.inputs.insert_image=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;return d=nbe.inputs.input("img",a),e=kite.browser.dom.eac("button",c,"wu-icon wu-icon-insert_image off"),e.title=b,f=new kite.browser.ui.Window,f.set_title("Insert image"),e.addEventListener("click",function(a){a.stopPropagation(),f.is_open?f.close():f.open()},!1),g=kite.browser.dom.ec("div","wu-image_window"),kite.browser.dom.ea("div",g).textContent="Image URL ",h=kite.browser.dom.ea("input",g),h.type="text",h.value="http://",kite.browser.dom.ea("div",g).textContent="Width ",i=kite.browser.dom.ea("input",g),i.type="text",kite.browser.dom.ea("div",g).textContent="Height ",j=kite.browser.dom.ea("input",g),j.type="text",kite.browser.dom.ea("div",g).textContent="Title ",k=kite.browser.dom.ea("input",g),k.type="text",l=kite.browser.dom.eac("div",g,"wu-special_character_buttons"),m=kite.browser.dom.eac("button",l,"button"),m.textContent="Insert image",n=kite.browser.dom.eac("button",l,"button"),n.textContent="Cancel",f.set_content(g),g.addEventListener("click",function(a){var b;m===a.target?(b={src:h.value},i.value!==""&&(b.width=i.value),j.value!==""&&(b.height=j.value),k.value!==""&&(b.title=k.value),d.trigger(b),h.value="http://",i.value="",j.value="",k.value="",f.close()):n===a.target&&f.close()},!1),d.element=e,d},nbe.inputs.edit_image=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r;return e=nbe.inputs.input("img",a),f=kite.browser.dom.eac("button",c,"wu-icon wu-icon-edit_image off"),f.title=b,kite.browser.dom.ea("img",f).src="/img/pen_alt2.svg",kite.browser.dom.ea("img",f).src="/img/image.svg",g=null,h=null,i=function(a){g=a,g?(h=g.id,l.value=g.src||"",m.value=g.width||"",n.value=g.height||"",o.value=g.title||"",f.className="wu-icon wu-icon-edit_image on"):(l.value="",m.value="",n.value="",o.value="",f.className="wu-icon wu-icon-edit_image off")},j=new kite.browser.ui.Window,j.set_title("Edit image"),f.addEventListener("click",function(a){a.stopPropagation(),j.is_open?j.close():g&&j.open()},!1),k=kite.browser.dom.ec("div","wu-image_window"),kite.browser.dom.ea("div",k).textContent="Image URL ",l=kite.browser.dom.ea("input",k),l.type="text",l.value="http://",kite.browser.dom.ea("div",k).textContent="Width ",m=kite.browser.dom.ea("input",k),m.type="text",kite.browser.dom.ea("div",k).textContent="Height ",n=kite.browser.dom.ea("input",k),n.type="text",kite.browser.dom.ea("div",k).textContent="Title ",o=kite.browser.dom.ea("input",k),o.type="text",p=kite.browser.dom.eac("div",k,"wu-special_character_buttons"),q=kite.browser.dom.eac("button",p,"button"),q.textContent="OK",r=kite.browser.dom.eac("button",p,"button"),r.textContent="Cancel",j.set_content(k),k.addEventListener("click",function(a){var b;q===a.target?(b={id:h,src:l.value},m.value!==""&&(b.width=m.value),n.value!==""&&(b.height=n.value),o.value!==""&&(b.title=o.value),e.trigger(b),j.close()):r===a.target&&j.close()},!1),i(d),e.element=f,e.set_value=i,e},nbe.title.create=function(a,b,c){var d,e,f,g,h,i,j;return e=function(a){g(a.value)},b.editable?(f=kite.browser.dom.ec("input","wu-title"),f.setAttribute("type","text"),g=function(a){d=a,f.value!==d&&(f.value=d),b.html_title&&(document.title=d)},h=function(b){var e,h;e=f.value,e!==d&&(g(e),h={editor_class:"title",before:d,after:e},c.add_ops(a,[h]))},f.addEventListener("input",h,!1)):(f=document.createElement("div"),g=function(a){d=a,f.textContent=d,b.html_title&&(document.title=d)}),i=function(a,b){a.forEach(function(a){"editor_class"in a&&a.editor_class==="title"&&g(a.after)})},j=function(){return d},{id:a,el_editor:f,init:e,add_external_ops:i,get_value:j}},nbe.title.state_copy=function(a){return{value:a.value}},nbe.title.state_init=function(){return{value:"My Title"}},nbe.title.state_update=function(a,b){b.length>0&&(a.value=b[b.length-1].after)},nbe.publish.create=function(a,b){var c,d,e,f,g,h,i;return c=null,d=function(a){h(a.time)},e=document.createElement("div"),f=function(d){var e,f;e=nbe.doc.html(nbe.dynamic.doc),f={type:"publish",id:b.ids.id,write:b.ids.write,html:e},nbe.lib.xhr("POST",nbe.config.publish_url,{},JSON.stringify(f),0,function(e){var f;e=JSON.parse(e),e==="published"&&(f={editor_class:"publish",before:c,after:Date.now()},h(f.after),b.add_ops(a,[f])),d(e)},function(){},function(){d(null)})},g=function(a,b){a.forEach(function(a){"editor_class"in a&&a.editor_class==="publish"&&h(a.after)})},h=function(a){c=a,e.textContent=c===null?"Not published":"Published at "+new Date(c)},i=function(){return c},{id:a,init:d,msg:e,publish:f,add_external_ops:g,get_time:i}},nbe.publish.state_copy=function(a){return{time:a.time}},nbe.publish.state_init=function(){return{time:null}},nbe.publish.state_update=function(a,b){b.length>0&&(a.time=b[b.length-1].after)},nbe.css.publish='/* Line styles */\n\n.wu-line, .wu-line > span {\n\tline-height : 160%;\n}\n\n.wu-line.wu-right {\n\ttext-align : right;\n}\n\n.wu-line.wu-center {\n\ttext-align : center;\n}\n\n.wu-line.wu-justify {\n\ttext-align : justify;\n}\n\n/* Line spacing */\n\n.wu-line_spacing_05, .wu-line_spacing_05 > span {\n\tline-height : 50%;\n}\n\n.wu-line_spacing_06, .wu-line_spacing_06 > span {\n\tline-height : 60%;\n}\n\n.wu-line_spacing_07, .wu-line_spacing_07 > span {\n\tline-height : 70%;\n}\n\n.wu-line_spacing_08, .wu-line_spacing_08 > span {\n\tline-height : 80%;\n}\n\n.wu-line_spacing_09, .wu-line_spacing_09 > span {\n\tline-height : 90%;\n}\n\n.wu-line_spacing_10, .wu-line_spacing_10 > span {\n\tline-height : 100%;\n}\n\n.wu-line_spacing_11, .wu-line_spacing_11 > span {\n\tline-height : 110%;\n}\n\n.wu-line_spacing_12, .wu-line_spacing_12 > span {\n\tline-height : 120%;\n}\n\n.wu-line_spacing_13, .wu-line_spacing_13 > span {\n\tline-height : 130%;\n}\n\n.wu-line_spacing_14, .wu-line_spacing_14 > span {\n\tline-height : 140%;\n}\n\n.wu-line_spacing_15, .wu-line_spacing_15 > span {\n\tline-height : 150%;\n}\n\n.wu-line_spacing_16, .wu-line_spacing_16 > span {\n\tline-height : 160%;\n}\n\n.wu-line_spacing_17, .wu-line_spacing_17 > span {\n\tline-height : 170%;\n}\n\n.wu-line_spacing_18, .wu-line_spacing_18 > span {\n\tline-height : 180%;\n}\n\n.wu-line_spacing_19, .wu-line_spacing_19 > span {\n\tline-height : 190%;\n}\n\n.wu-line_spacing_20, .wu-line_spacing_20 > span {\n\tline-height : 200%;\n}\n\n/* Lists */\n\n.wu-disc, .wu-square {\n\tdisplay : list-item;\n\tlist-style : inside;\n}\n\n.wu-lower-alpha, .wu-lower-roman , .wu-lower-roman, .wu-upper-alpha, .wu-upper-roman {\n\tdisplay : block;\n}\n\n.wu-disc {\n\tlist-style-type : disc;\n}\n\n.wu-lower-alpha:before {\n\tcounter-increment : item;\n\tcontent : counter(item, lower-alpha) ". "\n}\n\n.wu-lower-roman:before {\n\tcounter-increment : item;\n\tcontent : counter(item, lower-roman) ". "\n}\n\n.wu-square {\n\tlist-style-type : square;\n}\n\n.wu-upper-alpha:before {\n\tcounter-increment : item;\n\tcontent : counter(item, upper-alpha) ". "\n}\n\n.wu-upper-roman:before {\n\tcounter-increment : item;\n\tcontent : counter(item, upper-roman) ". "\n}\n\n.wu-ordered {\n\tdisplay : block;\n}\n\n.wu-ordered:before {\n\tcounter-increment : item;\n\tcontent : counter(item) ". "\n}\n\n.wu-reset-counter {\n\tcounter-reset : item;\n}\n\n/* Heading */\n\n.wu-line.wu-heading1, .wu-line.wu-heading1 span {\n\tdisplay: block;\n\tpadding-top: 4px;\n\tpadding-bottom: 4px;\n\tfont-size: 135%;\n}\n\n.wu-line.wu-heading2, .wu-line.wu-heading2 span {\n\tdisplay: block;\n\tpadding-top: 4px;\n\tpadding-bottom: 4px;\n\tfont-size: 130%;\n}\n\n.wu-line.wu-heading3, .wu-line.wu-heading3 span {\n\tdisplay: block;\n\tpadding-top: 4px;\n\tpadding-bottom: 4px;\n\tfont-size: 125%;\n}\n\n.wu-line.wu-heading4, .wu-line.wu-heading4 span {\n\tdisplay: block;\n\tpadding-top: 4px;\n\tpadding-bottom: 4px;\n\tfont-size: 120%;\n}\n\n.wu-line.wu-heading5, .wu-line.wu-heading5 span {\n\tdisplay: block;\n\tpadding-top: 4px;\n\tpadding-bottom: 4px;\n\tfont-size: 115%;\n}\n\n.wu-line.wu-heading6, .wu-line.wu-heading6 span {\n\tdisplay: block;\n\tpadding-top: 4px;\n\tpadding-bottom: 4px;\n\tfont-size: 110%;\n}\n\n.wu-line.wu-heading1 span, .wu-line.wu-heading2 span, .wu-line.wu-heading3 span, .wu-line.wu-heading4 span, .wu-line.wu-heading5 span, .wu-line.wu-heading6 span {\n\tdisplay : inline-block;\n}\n\n/* Text styles */\n\n.wu-text.wu-bold {\n\tfont-weight : bold;\n}\n\n.wu-text.wu-underline {\n\ttext-decoration : underline;\n}\n\n.wu-text.wu-italic {\n\tfont-style : italic;\n}\n\n.wu-text.wu-strikethrough {\n\ttext-decoration : line-through;\n}\n\nbody {\n\tmargin : 0;\n}\n\ndiv.editor {\n\twhite-space : pre-wrap;\n\tword-wrap : break-word;\n\tfont-size : 16px;\n\tfont-family : Arial;\n\tline-height : 120%;\n\tline-height : 160%;\n\tpadding : 30px 50px;\n}\n\ndiv.editor span {\n\tfont-size : 16px;\n\tfont-family : Arial;\n}\n\n'